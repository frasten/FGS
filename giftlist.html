<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<link type="text/css" href="css/blitzer/jquery-ui-1.8.4.custom.css" rel="stylesheet" />	
<link type="text/css" href="css/jquery.contextMenu.css?version=1.0.0.8" rel="stylesheet" />
<link rel="shortcut icon" href="gfx/favicon.ico" />
<title>Friendly Gaming Simplifier</title>
<script type="text/javascript" src="scripts/jquery-1.4.2.min.js"></script>
<script type="text/javascript" src="scripts/jquery-ui-1.8.4.custom.min.js"></script>
<script type="text/javascript" src="scripts/jquery.utils.js"></script>
<script type="text/javascript" src="scripts/jquery.contextMenu.js?version=1.0.0.8"></script>
<script type="text/javascript" src="scripts/jquery.tablesorter.min.js"></script>

<script type="text/javascript" src="scripts/time.js?version=1.0.0.8"></script>
<script type="text/javascript" src="scripts/notices.js?version=1.0.0.8"></script>
<script type="text/javascript" src="browser_files/browser.js?version=1.0.0.8"></script>
<script type="text/javascript">
	var loaded = 0;
	
	var isScreenLocked = false;
	var chatInterval = null;

	function updateLoaded()
	{
		loaded++;
		$( "#progressbar" ).progressbar('option', 'value', loaded*20);
		
		if(loaded == 5)
		{
			updateCount();
			$( "#dialog-loading" ).dialog("close");
		}
	}
	
	function hiddenFeed(gameID)
	{
		var game = bkP.gamesData[gameID].systemName;
		var opt = 'BonusesPendingList';
		
		if($('div#'+game+opt, '#'+game+'Game').children('div').length == 0)
		{
			$('div#'+game+opt, '#'+game+'Game').html('<h3 class="fvBonusErr">There was a problem collecting bonuses. You may have this game hidden in your news feeds.<br /><br />To unhide it, follow this steps: <br /><br />- Click "Friends" on the left side under the Facebook icon<br />- Click "Status Updates" under "Friends"<br />- Scroll all the way to the bottom and click "Edit Options" (The one on the status updates page is different from the news feed one)<br />- Click the "Applications" tab and click "Add To News Feed" on the one you wish to unhide.</h3><br style="clear:both" />');
		}
	}

	function capitaliseFirstLetter(string)
	{
		return string.charAt(0).toUpperCase() + string.slice(1);
	}
	
	function SelectFavourites(gameID)
	{
		var game = bkP.gamesData[gameID].systemName;
		var opt = 'SendFreeGiftsList';
		
		ClearSelection(gameID);
		$('.favouritesTable', 'div#'+game+opt).find('input[name="neighArr[]"]:lt(25)').each(function() { $(this).click(); });
	}
	
	function ClearSelection(gameID)
	{
		var game = bkP.gamesData[gameID].systemName;
		var opt = 'SendFreeGiftsList';
		$('input[name="neighArr[]"]', 'div#'+game+opt).removeAttr('checked');
	}
	
	function SelectNonFavourites(gameID)
	{
		var game = bkP.gamesData[gameID].systemName;
		var opt = 'SendFreeGiftsList';
		
		ClearSelection(gameID);
		$('.neighborsTable', 'div#'+game+opt).find('input[name="neighArr[]"]:lt(25)').each(function() { $(this).click(); });
	}
	
	function listGifts(gameID)
	{
		var game = bkP.gamesData[gameID].systemName;
		var opt = 'SendFreeGiftsList';
		
		for(var id in bkP.giftsArray[gameID])
		{
			var v = bkP.giftsArray[gameID][id];
			$('.sendToGiftsList','div#'+game+opt).append('<div class="selectGiftToSend" gameID="'+gameID+'" title="'+v.name+'" alt="'+v.name+'" giftID="'+id+'"><img  style="width: 32px; height: 32px;margin:2px auto;" src="http://fgs.rzadki.eu/reqs/'+game+'/'+id+'.png"><div style="font-size: 11px;">'+v.name+'</div></div>');
		}
		
		if(bkP.options.games[gameID].defaultGift == 0)
		{
			$('.sendToGiftsList','div#'+game+opt).children('div:first').addClass('selected');
		}
		else
		{
			$('.sendToGiftsList','div#'+game+opt).children('div[giftID="'+bkP.options.games[gameID].defaultGift+'"]').addClass('selected');
		}
		$('.sendToGiftsList','div#'+game+opt).append('<br class="clear" style="clear:both"/>');
	}
	
	function SendGifts(gameID)
	{
		var game = bkP.gamesData[gameID].systemName;
		var opt = 'SendFreeGiftsList';

		var sendTo = [];
		
		$('input[name="neighArr[]"]:checked:visible','div#'+game+opt).each(function()
		{
			sendTo.push($(this).val());
		});
		
		if(sendTo.length == 0)
		{
			alert('You must select at least one person');
			return;
		}
				
		var gift 	 = $('.sendToGiftsList > div.selected','div#'+game+opt).attr('giftID');
		var giftName = $('.sendToGiftsList > div.selected','div#'+game+opt).attr('title');
		
		var params = {
			gift: gift,
			gameID:	gameID,
			sendTo: sendTo
		};
		
		$('div#'+game+opt, '#'+game+'Game').children().addClass('hide');
		$('div#'+game+'SendFreeGiftsSubMenu', '#'+game+'Game').children('button:gt(0)').addClass('hide');
		
		$('div#'+game+opt, '#'+game+'Game').prepend('<div class="sendingGiftProgress"><h3 class="center"><img src="gfx/loading.gif"><br />Sending "'+giftName+'" to '+sendTo.length+' people</h3></div>');
				
		eval('bkP.'+game+'Freegifts.Click(params)');
	}
	
	function freegiftSuccess(data, data2)
	{
		var gameID = data.gameID;
		var game = bkP.gamesData[gameID].systemName;
		var opt = 'SendFreeGiftsList';
		
		$('div#'+game+opt, '#'+game+'Game').children('.sendingGiftProgress').html('<h3 class="center"><img src="gfx/90px-check.png"><br /><img src="gfx/loading.gif"><br /> Gift was succesfully sent. Waiting for new neighbor list to load.</h3>');
		
		$(getGiftHistoryRow(gameID, data, data2)).prependTo('#'+game+'SendFreeGiftsHistoryList');
	}
	
	function freegiftError(gameID)
	{
		var game = bkP.gamesData[gameID].systemName;
		var opt = 'SendFreeGiftsList';	
		
		$('div#'+game+'SendFreeGiftsSubMenu', '#'+game+'Game').children('button:gt(0)').removeClass('hide');
		$('div#'+game+opt, '#'+game+'Game').children().removeClass('hide');
		
		$('div#'+game+opt, '#'+game+'Game').children('.sendingGiftProgress').html('<h3 class="center"><img src="gfx/90px-cancel.png"><br /> There was an error with sending gifts. It could one of this:<br />- you reached facebook limit for sending gifts for this application,<br />- there was a connection error,<br />- you choose gift that requires level that you don\'t have. Try again.</h3>');
		
	}
	

	function getGiftHistoryRow(gameID, v, thankYou)
	{
		var game = bkP.gamesData[gameID].systemName;
		
		if(thankYou != '' && thankYou != 0)
		{
			var thankText = '<br /><br />Thank you gift';
		}
		else
		{
			var thankText = '';
		}		
		return  '<div class="freegiftHistory updateTimeAgo" title="'+v.friend+'" alt="'+v.friend+'" time="'+v.time+'"><span class="timeAgo">'+format_time_ago(v.time)+'</span><br /><img  style="width: 32px; height: 32px;margin:2px auto;" src="http://fgs.rzadki.eu/reqs/'+game+'/'+v.gift+'.png"><div style="font-size: 11px;">'+v.friend+''+thankText+'</div></div>'
	}
	
	function checkIfBonusIsManual(gameID, typeText)
	{
		var ret = false;
		$(bkP.gamesData[gameID].filter.bonusesNewWindow).each(function(k,v)
		{
			var re = new RegExp(v, "i") ;
			
			if(re.test(typeText))
			{
				ret = true;
				return false;
			}
		});
		
				
		return ret;
	}
	
	function checkIfRequestIsManual(gameID, typeText)
	{
		var ret = false;
		$(bkP.gamesData[gameID].filter.requestsNewWindow).each(function(k,v)
		{
			var re = new RegExp(v, "i") ;
			
			if(re.test(typeText))
			{
				ret = true;
				return false;
			}
		});
		
		return ret;
	}
	
	function getNewBonusRow(gameID, v)
	{
		var title = v.title;
		title = title.replace(/'/gi, '');

		var newUrl = v.url;
		
		var classHide = isScreenLocked ? ' hideScreenLocked ' : '';
		
		
		
		return '<div id="'+v.id+'" gameID="'+gameID+'" title="'+title+'" time="'+v.time+'" url="'+newUrl+'" class="bonusItem '+classHide+' showContext updateTimeAgo awaitingClick"><span class="timeAgo">'+format_time_ago(v.time)+'</span><span class="bonusError"></span><img src="'+v.image+'"><span class="title">'+v.title+'</span><span>'+v.text+'</span></div>';
	}
	
	function getNewRequestRow(gameID, v)
	{
		var game = bkP.gamesData[gameID].systemName;
		var title = v.title;
		title = title.replace(/'/gi, '');
		
		if(v.image.indexOf('http') != -1)
		{
			var url = v.image;
		}
		else
		{
			var url = 'http://fgs.rzadki.eu/reqs/'+game+'/'+v.image+'.png';
		}
		
		var classHide = isScreenLocked ? ' hideScreenLocked ' : '';
		
		return '<div id="'+v.id+'" gameID="'+gameID+'" title="'+title+'" origTitle="'+v.title+'" time="'+v.time+'" postdata="'+v.post+'" class="requestItem '+classHide+' showContextRequests updateTimeAgo awaitingClick"><span class="timeAgo">'+format_time_ago(v.time)+'</span><span class="bonusError"></span><img src="'+url+'" onError="$(this).attr(\'src\', \'icons/reqs/noimage.png\');$(this).closest(\'div\').attr(\'isMissingImage\', true);"><span class="title">'+v.title+'</span><span>'+v.text+'</span></div>';
	}
	
	function getNewManualBonusRow(gameID, v)
	{
		var title = v.title;
		title = title.replace(/'/gi, '');
		
		var classHide = isScreenLocked ? ' hideScreenLocked ' : '';
		
		return '<div id="'+v.id+'" gameID="'+gameID+'" title="'+title+'" time="'+v.time+'" url="'+v.url+'" class="manualItem '+classHide+' showContextManual updateTimeAgo manualBonus awaitingClick"><span class="timeAgo">'+format_time_ago(v.time)+'</span><span class="bonusError"></span><img src="'+v.image+'"><span class="title">'+v.title+'</span><span>'+v.text+'</span></div>';
	}
	
	function getNewManualRequestRow(gameID, v)
	{
		var game = bkP.gamesData[gameID].systemName;
		var title = v.title;
		title = title.replace(/'/gi, '');
		
		if(v.image.indexOf('http') != -1)
		{
			var url = v.image;
		}
		else
		{
			var url = 'http://fgs.rzadki.eu/reqs/'+game+'/'+v.image+'.png';
		}
		
		var classHide = isScreenLocked ? ' hideScreenLocked ' : '';
		
		return '<div id="'+v.id+'" gameID="'+gameID+'" title="'+title+'" origTitle="'+v.title+'" time="'+v.time+'" postdata="'+v.post+'" class="manualItem '+classHide+' updateTimeAgo manualRequest awaitingClick"><span class="timeAgo">'+format_time_ago(v.time)+'</span><span class="bonusError"></span><img src="'+url+'" onError="$(this).attr(\'src\', \'icons/reqs/noimage.png\');$(this).closest(\'div\').attr(\'isMissingImage\', true);"><span class="title">'+v.title+'</span><span>'+v.text+'</span></div>';
	}
	
	
	function processManualBonusClick(e)
	{
		var gameID = $(e.currentTarget).attr('gameID');
		$(e.currentTarget).unbind('click');
		var URI = $(e.currentTarget).attr('url');
		$(e.currentTarget).remove();
		bkP.database.deleteItem('bonuses', gameID, $(e.currentTarget).attr('id'), 0);
		bkP.database.deleteItem('bonuses', gameID, $(e.currentTarget).attr('id'), 1);
		bkP.openURI(URI, true);
		updateCount(gameID);
	}
	
	function processManualRequestClick(e)
	{
		var gameID = $(e.currentTarget).attr('gameID');
		$(e.currentTarget).unbind('click');
		bkP.database.deleteItem('requests', gameID, $(e.currentTarget).attr('id'), 0);
		bkP.database.deleteItem('requests', gameID, $(e.currentTarget).attr('id'), 1);
		bkP.getRequestLink($(e.currentTarget).attr('id'), $(e.currentTarget).attr('postData')+'&post_form_id='+bkP.post_form_id+'&fb_dtsg='+bkP.fb_dtsg);
		$(e.currentTarget).remove();
		updateCount(gameID);
	}
	
	function addNewBonus(data2)
	{
		var gameID = data2[0][1];
		var game = bkP.gamesData[gameID].systemName;
		
		$('div#'+game+'BonusesPendingList', '#'+game+'Game').find('.fvBonusErr').remove();		
		
		var html = '';
		var htmlManual = '';
			
		$(data2).each(function(ind,data)
		{
			var v = {	id: data[0],	title: data[2],	text: data[3],	image: data[4],	url: data[5],	time: data[6]	}
			
					
			if(checkIfBonusIsManual(gameID, v.title))
			{
				htmlManual += getNewManualBonusRow(gameID, v);
			}
			else
			{		
				html += getNewBonusRow(gameID, v);
			}
		});

		$('div#'+game+'ManualBonusesList').prepend(htmlManual);
		$('div#'+game+'ManualBonusesList').children('div.manualBonus.awaitingClick').removeClass('awaitingClick').click(processManualBonusClick);
		
		$('div#'+game+'BonusesPendingList').prepend(html);
		$('div#'+game+'BonusesPendingList').children('div.awaitingClick').removeClass('awaitingClick').click(processBonusClick);

		if($('div#'+game+'BonusesPendingList:visible').length > 0)
		{
			$('.optionsMenu', $('#'+game+'Game')).children('input:nth-child(1)').attr('checked', 'checked').trigger('click');
			$('.optionsMenu', $('#'+game+'Game')).buttonset('refresh');
		}
		updateCount(gameID);
		
		/* Autoaccept bonuses */
		if (bkP.options.games[gameID].autoAcceptBonus) {
			ReceivePendingBonuses(gameID);
		}
	}
	
	function processBonusClick(e)
	{
		var gameID = $(e.currentTarget).attr('gameID');
		var game =  bkP.gamesData[gameID].systemName;


		$(e.currentTarget).disableContextMenu().unbind('click').addClass('inProgress');
		$(e.currentTarget).find('img:last').attr('orig-src', $(e.currentTarget).find('img:last').attr('src')).attr('src', 'gfx/dl.gif').css({ width: '64px', height: '64px'});
		
		var obj = {
					id: $(e.currentTarget).attr('id'),
					url: $(e.currentTarget).attr('url'),
					game: game,
					type: 'bonus',
					title: $(e.currentTarget).attr('title')
				}
		
		bkP.xhrQueue.push(obj);
		updateQueueCount();
	}
	
	function processRequestsClick(e)
	{
		var gameID = $(e.currentTarget).attr('gameID');
		var game =  bkP.gamesData[gameID].systemName;
		
		$(e.currentTarget).disableContextMenu().unbind('click').addClass('inProgress');
		$(e.currentTarget).find('img:last').attr('orig-src', $(e.currentTarget).find('img:last').attr('src')).attr('src', 'gfx/dl.gif').css({ width: '64px', height: '64px'});
		
		var obj = {
					id: $(e.currentTarget).attr('id'),
					post: $(e.currentTarget).attr('postData')+'&post_form_id='+bkP.post_form_id+'&fb_dtsg='+bkP.fb_dtsg,
					game: game,
					type: 'request',
					title: $(e.currentTarget).attr('title')
				}
		
		bkP.xhrQueue.push(obj);
		updateQueueCount();
		
		//bkP.prepareLinkForGame(game,$(e.currentTarget).attr('id'), );
	}
	
	function ReceivePendingBonuses(gameID)
	{
		var game = bkP.gamesData[gameID].systemName;
		$('#'+game+'BonusesPendingList').children('div').not('.hideScreenLocked').not('.inProgress').each(function(){
			$(this).trigger('click');
		});
	}
	
	function ReceivePendingRequests(gameID)
	{
		var game = bkP.gamesData[gameID].systemName;
		$('#'+game+'RequestsPendingList').children('div').not('.hideScreenLocked').not('.inProgress').each(function(){
			$(this).trigger('click');
		});
	}
	
	function bonusError(id, data)
	{
	
		$('#'+id).find('img:last').attr('src', 'gfx/90px-cancel.png');
		
		var error_text = (typeof(data.error_text) != 'undefined'  ? ' <img src="gfx/info.png" title="'+data.error_text+'" />' : '');
		
		$('#'+id).find('.bonusError').html('('+data.error+' error)'+error_text);
		
		var gameID = $('#'+id).attr('gameID');
		var game = bkP.gamesData[gameID].systemName;
		
		updateQueueCount();
		
		bonusErrorFinish(id, data);
	}
	
	function bonusErrorFinish(id, data)
	{
		if(isScreenLocked)
		{
			setTimeout(function() { bonusErrorFinish(id, data) }, 1000);
			return;
		}
		
		var gameID = $('#'+id).attr('gameID');
		var game = bkP.gamesData[gameID].systemName;
		
		if(data.error == 'connection' || data.error == 'other')
		{
			setTimeout(function() {
				$('#'+id).enableContextMenu().click(processBonusClick).removeClass('inProgress');
				$('#'+id).find('img:last').attr('src', $('#'+id).find('img:last').attr('orig-src'));
			}, 1000);
		}
		else
		{
			setTimeout(function()
			{
				$('#'+id).unbind('mousedown').unbind('contextmenu').unbind('mouseup').die().prependTo('#'+game+'BonusesHistoryList');
				$('#'+id).removeClass('hide').attr('time', data.time).find('.timeAgo').text(format_time_ago(data.time));
				
				if(data.error == 'receiving')
				{
					$('div#'+id).css('cursor', 'pointer !important').attr('title', 'Click to manually receive').click(processManualBonusClick);
				}
				
				updateCount(gameID);
				
				if($('div#'+game+'BonusesPendingList:visible').length > 0)
				{
					$('.optionsMenu', $('#'+game+'Game')).children('input:nth-child(1)').attr('checked', 'checked').trigger('click');
					$('.optionsMenu', $('#'+game+'Game')).buttonset('refresh');
				}				
			}, 1000);
		}
	}
	
	function bonusSuccess(id, data)
	{
		$('#'+id).find('img:last').attr('src', 'gfx/90px-check.png');
		
		var error_text = (typeof(data.error_text) != 'undefined'  ? ' <img src="gfx/info.png" title="'+data.error_text+'" />' : '');
		
		$('#'+id).find('.bonusError').html(error_text);
		
		var gameID = $('#'+id).attr('gameID');
		var game = bkP.gamesData[gameID].systemName;
		
		updateQueueCount();
		
		bonusSuccessFinish(id, data);
	}
	
	function bonusSuccessFinish(id, data)
	{
		if(isScreenLocked)
		{
			setTimeout(function() { bonusSuccessFinish(id, data) }, 1000);
			return;
		}
		
		var gameID = $('#'+id).attr('gameID');
		var game = bkP.gamesData[gameID].systemName;
	
		setTimeout(function() 
		{
			$('#'+id).prependTo('#'+game+'BonusesHistoryList');
			$('#'+id).removeClass('hide').removeClass('inProgress');

			if(data.image !== '')
			{
				$('#'+id).find('img:last').attr('src', data.image);
			}
			else
			{
				$('#'+id).find('img:last').attr('src', $('#'+id).find('img:last').attr('orig-src'));
			}
			
			
			if(data.title != '')
			{
				$('#'+id).find('.title').text(data.title);
			}
			
			
			var infoAdd = '';
			
			if(typeof(data.thanks) != 'undefined' && data.thanks != '')
			{
				infoAdd = JSON.stringify(data.thanks);
			}
			
			$('#'+id).find('.bonusError').css('height', '23px').html(addLikeRow(false, infoAdd, false));
			$('#'+id).find('.bonusError').find('.likeBonus').click(processLikeBonus);
			$('#'+id).find('.bonusError').find('.commentBonus').click(processCommentBonus);
			$('#'+id).find('.bonusError').find('.sendBack').click(processSendBack);
			
			if(typeof $('#'+id).attr('isLiked') !== 'undefined')
			{
				updateLikeState('#'+id, 0);
			}
			
			if(typeof $('#'+id).attr('isCommented') !== 'undefined')
			{
				updateCommentState('#'+id, 0);
			}
			
			if(data.text != '')
			{
				$('#'+id).find('.title').next('span').text(data.text);
			}
			
			$('#'+id).attr('time', data.time).find('.timeAgo').text(format_time_ago(data.time));
			updateCount(gameID);
			
			if($('div#'+game+'BonusesPendingList:visible').length > 0)
			{
				$('.optionsMenu', $('#'+game+'Game')).children('input:nth-child(1)').attr('checked', 'checked').trigger('click');
				$('.optionsMenu', $('#'+game+'Game')).buttonset('refresh');
			}
			
		}, 1000);
	}
	
	function addLikeRow(like, sendBack, comm, isRequest)
	{
		
		var sendBackHtml = '';

		if(sendBack != '' && sendBack != null && sendBack != '""')
		{
			var sendBackJson = JSON.parse(sendBack);
			
			if(typeof(sendBackJson.sent) == 'undefined')
			{
				var img3 = 'gfx/sendback.png';
				var enabled = 'true';
				var cursor = 'cursor: pointer';
				var className = 'sendBack';
				var desc = 'Click to send Thank You Gift';
			}
			else
			{
				var img3 = 'gfx/sendback-off.png';
				var enabled = 'false';
				var cursor = '';
				var className = '';
				var desc = 'You already sent gift back';
			}
			sendBackHtml = '<img src="'+img3+'" class="'+className+'" isEnabled="'+enabled+'" title="" style="'+cursor+'"><span style="display: none">'+sendBack+'</span>';
		}
		
		if(typeof(isRequest) != 'undefined')
		{
			return '<div style="position: relative"><div style="position: absolute;left:48;">'+sendBackHtml+'</div></div>';
		}
		else
		{
			if(like == false || like == 0)
			{
				var img = 'gfx/like.png';
				var addClassLike = '';
			}
			else
			{
				var img = 'gfx/like-off.png';
				var addClassLike = ' disabledLike';
			}
			
			if(comm == false || comm == 0)
			{
				var img2 = 'gfx/comment.png';
				var addClassComm = '';
			}
			else
			{
				var img2 = 'gfx/comment-off.png';
				var addClassComm = ' disabledComment';
			}
		
			return '<div style="position: relative"><div style="position: absolute;left:0;"><img src="'+img+'" class="likeBonus'+addClassLike+'" title="Click to like this bonus" style="cursor: pointer"></div><div style="position: absolute;left:60;">'+sendBackHtml+'</div><div style="position: absolute;right:0;"><img src="'+img2+'" class="commentBonus'+addClassComm+'" title="Click to send random comment on this bonus" style="cursor: pointer"></div></div>';
		}
	}
	
	function requestError(id, data)
	{
		$('#'+id).find('img:last').attr('src', 'gfx/90px-cancel.png');
		
		var error_text = (typeof(data.error_text) != 'undefined'  ? ' <img src="gfx/info.png" title="'+data.error_text+'" />' : '');
		
		$('#'+id).find('.bonusError').html('('+data.error+' error)'+error_text);
		
		var gameID = $('#'+id).attr('gameID');
		var game = bkP.gamesData[gameID].systemName;
		
		updateQueueCount();
		
		requestErrorFinish(id, data);
	}
	
	function requestErrorFinish(id, data)
	{
		if(isScreenLocked)
		{
			setTimeout(function() { requestErrorFinish(id, data) }, 1000);
			return;
		}
		
		var gameID = $('#'+id).attr('gameID');
		var game = bkP.gamesData[gameID].systemName;
		
		if(data.error == 'connection')
		{
			setTimeout(function() {
				$('#'+id).enableContextMenu().click(processRequestsClick).removeClass('inProgress');
				$('#'+id).find('img:last').attr('src', $('#'+id).find('img:last').attr('orig-src'));
			}, 1000);
		}
		else
		{
			setTimeout(function() {
				$('#'+id).unbind('mousedown').unbind('contextmenu').unbind('mouseup').die().prependTo('#'+game+'RequestsHistoryList');
				$('#'+id).attr('time', data.time).find('.timeAgo').text(format_time_ago(data.time));
				
				if(data.error == 'receiving')
				{
					$('div#'+id).css('cursor', 'pointer !important').attr('title', 'Click to manually receive').click(processManualRequestClick);
				}				
				
				updateCount(gameID);
			}, 1000);
		}
	}
	
	function requestSuccess(id, data)
	{
		$('#'+id).find('img:last').attr('src', 'gfx/90px-check.png');
		
		var error_text = (typeof(data.error_text) != 'undefined'  ? ' <img src="gfx/info.png" title="'+data.error_text+'" />' : '');		
		$('#'+id).find('.bonusError').html(error_text);
		
		var gameID = $('#'+id).attr('gameID');
		var game = bkP.gamesData[gameID].systemName;
		
		updateQueueCount();
		
		requestSuccessFinish(id, data);
	}
	
	
	function requestSuccessFinish(id, data)
	{
		if(isScreenLocked)
		{
			setTimeout(function() { requestSuccessFinish(id, data) }, 1000);
			return;
		}
		
		var gameID = $('#'+id).attr('gameID');
		var game = bkP.gamesData[gameID].systemName;
		
		setTimeout(function() {
			$('#'+id).prependTo('#'+game+'RequestsHistoryList');
			$('#'+id).removeClass('inProgress');
			
			if(data.image !== '')
			{
				$('#'+id).find('img:last').attr('src', data.image);
			}
			else
			{
				$('#'+id).find('img:last').attr('src', $('#'+id).find('img:last').attr('orig-src'));
			}
			
			
			if(data.title != '')
			{
				$('#'+id).find('.title').text(data.title);
			}

			
			var infoAdd = '';
			
			if(typeof(data.thanks) != 'undefined' && data.thanks != '')
			{
				if(data.thanks != '' && typeof(data.thanks.gift) != 'undefined' && data.image != '')
				{
					if($('#'+id).attr('isMissingImage'))
						$.getJSON('http://rzadki.eu/projects/fgs/jsonp/gifts.php?callback=?', {gameID: gameID, gift: data.thanks.gift, image: data.image});
				}
				infoAdd = JSON.stringify(data.thanks);
			}
			
			$('#'+id).find('.bonusError').css('height', '23px').html(addLikeRow(false, infoAdd, false, true));
			$('#'+id).find('.bonusError').find('.likeBonus').click(processLikeBonus);
			$('#'+id).find('.bonusError').find('.commentBonus').click(processCommentBonus);
			$('#'+id).find('.bonusError').find('.sendBack').click(processSendBack);	
			
			if(typeof $('#'+id).attr('SendbackInProgress') !== 'undefined')
			{
				updateSendbackState('#'+id);
			}
			
			$('#'+id).find('.title').next('span').text(data.text);
			$('#'+id).attr('time', data.time).find('.timeAgo').text(format_time_ago(data.time));
			updateCount(gameID);
		}, 1000);
	}
	
	function ClearManualBonuses(gameID)
	{
		var game = bkP.gamesData[gameID].systemName;
		
		
		var delReqArr = delBonArr = [];

		$('#'+game+'ManualBonusesList').children('div').not('.hideScreenLocked').each(function()
		{
			var elID = $(this).attr('id');
			if($(this).hasClass('manualRequest'))
			{
				var postData = $(this).attr('postData');
				var pos1 = postData.indexOf('&actions%5B');
				
				var postData = postData.slice(0,pos1);
				postData += '&actions[reject]=Ignore';
				bkP.emptyUnwantedGifts(postData);
				
				delReqArr.push(elID);
			}
			else
			{
				delBonArr.push(elID);
			}
			
			$(this).remove();
		});
		updateCount(gameID);
		
		while(delReqArr.length > 0)
		{
			var tmpArr = delReqArr.slice(0,500);
			
			var str = ' where id = "'+tmpArr.join('" or id = "')+'" ';
			bkP.database.deleteItemArray('requests', gameID, str, 0);
			
			delReqArr = delReqArr.slice(500);						
		}
		
		while(delBonArr.length > 0)
		{
			var tmpArr = delBonArr.slice(0,500);
			
			var str = ' where id = "'+tmpArr.join('" or id = "')+'" ';
			bkP.database.deleteItemArray('bonuses', gameID, str, 0);
			
			delBonArr = delBonArr.slice(500);						
		}
	}
	
	function ClearPendingBonuses(gameID)
	{
		$('#dialog-confirm').dialog({
			buttons:
			{
				"Delete all items": function()
				{
					var game = bkP.gamesData[gameID].systemName;
					var delArr = [];

					$('#'+game+'BonusesPendingList').children('div').not('.hideScreenLocked').not('.inProgress').each(function()
					{
						delArr.push($(this).attr('id'));
						$(this).remove();
					});
					
					while(delArr.length > 0)
					{
						var tmpArr = delArr.slice(0,500);
						
						var str = ' where id = "'+tmpArr.join('" or id = "')+'" ';
						bkP.database.deleteItemArray('bonuses', gameID, str, 0);
						
						delArr = delArr.slice(500);						
					}
					updateCount(gameID);
					
					
					$( this ).dialog( "close" );
				},
				Cancel: function() {
					$( this ).dialog( "close" );
				}
		}});
		
		$('#dialog-confirm').dialog('open');
	}
	
	function ClearPendingRequests(gameID)
	{
		$('#dialog-confirm').dialog({
			buttons:
			{
				"Delete all items": function()
				{
					var game = bkP.gamesData[gameID].systemName;
		
					var delArr = [];
					
					$('#'+game+'RequestsPendingList').children('div').not('.hideScreenLocked').not('.inProgress').each(function()
					{
						var postData = $(this).attr('postData');
						var pos1 = postData.indexOf('&actions%5B');
						
						var postData = postData.slice(0,pos1);
						postData += '&actions[reject]=Ignore';
						$(this).remove();
						bkP.emptyUnwantedGifts(postData);
						delArr.push($(this).attr('id'));
					});
					
					while(delArr.length > 0)
					{
						var tmpArr = delArr.slice(0,500);
						
						var str = ' where id = "'+tmpArr.join('" or id = "')+'" ';
						bkP.database.deleteItemArray('requests', gameID, str, 0);
						
						delArr = delArr.slice(500);						
					}
					
					updateCount(gameID);

					$( this ).dialog( "close" );
				},
				Cancel: function() {
					$( this ).dialog( "close" );
				}
		}});
		
		$('#dialog-confirm').dialog('open');
	}
	
	function ClearCollectedBonuses(gameID)
	{
		$('#dialog-confirm').dialog({
			buttons:
			{
				"Delete all items": function()
				{
					var game = bkP.gamesData[gameID].systemName;
					$('#'+game+'BonusesHistoryList').html('<br style="clear:both" />');
					updateCount(gameID);
					bkP.database.clearTable('bonuses', gameID, 1);
					$( this ).dialog( "close" );
				},
				Cancel: function() {
					$( this ).dialog( "close" );
				}
		}});
		
		$('#dialog-confirm').dialog('open');
	}
	
	function ClearPendingBonusesOtherError(gameID)
	{
		$('#dialog-confirm').dialog({
			buttons:
			{
				"Delete other errors": function()
				{
					var game = bkP.gamesData[gameID].systemName;
					
					var delArr = [];
					
					
					$('#'+game+'BonusesPendingList').children('div').not('.hideScreenLocked').not('.inProgress').each(function(){
						if($(this).find('.bonusError').text().indexOf('other error') != -1)
						{
							delArr.push($(this).attr('id'));
							$(this).remove();
						}
					});
					
					while(delArr.length > 0)
					{
						var tmpArr = delArr.slice(0,500);
						
						var str = ' where id = "'+tmpArr.join('" or id = "')+'" ';
						bkP.database.deleteItemArray('bonuses', gameID, str, 0);
						
						delArr = delArr.slice(500);						
					}
					updateCount(gameID);
					
					$( this ).dialog( "close" );
				},
				Cancel: function() {
					$( this ).dialog( "close" );
				}
		}});
		
		$('#dialog-confirm').dialog('open');
	}
	
	function ClearCollectedBonusesLimitError(gameID)
	{
		$('#dialog-confirm').dialog({
			buttons:
			{
				"Delete limit errors": function()
				{
					var game = bkP.gamesData[gameID].systemName;
					$('#'+game+'BonusesHistoryList').children('div').each(function(){
						if($(this).find('.bonusError').text().indexOf('limit') != -1)
						{
							$(this).remove();
						}
					});
					//('<br style="clear:both" />');
					bkP.database.clearLimitErrors(gameID);
					$( this ).dialog( "close" );
				},
				Cancel: function() {
					$( this ).dialog( "close" );
				}
		}});
		
		$('#dialog-confirm').dialog('open');
	}
	
	function ClearCollectedBonusesReceivingError(gameID)
	{
		$('#dialog-confirm').dialog({
			buttons:
			{
				"Delete receiving errors": function()
				{
					var game = bkP.gamesData[gameID].systemName;
					$('#'+game+'BonusesHistoryList').children('div').each(function(){
						if($(this).find('.bonusError').text().indexOf('receiving') != -1)
						{
							$(this).remove();
						}
					});
					//('<br style="clear:both" />');
					bkP.database.clearReceivingErrors(gameID);
					$( this ).dialog( "close" );
				},
				Cancel: function() {
					$( this ).dialog( "close" );
				}
		}});
		
		$('#dialog-confirm').dialog('open');
	}
	
	function ClearCollectedRequestsReceivingError(gameID)
	{
		$('#dialog-confirm').dialog({
			buttons:
			{
				"Delete receiving errors": function()
				{
					var game = bkP.gamesData[gameID].systemName;
					$('#'+game+'RequestsHistoryList').children('div').each(function(){
						if($(this).find('.bonusError').text().indexOf('receiving') != -1)
						{
							$(this).remove();
						}
					});
					//('<br style="clear:both" />');
					bkP.database.clearRequestReceivingErrors(gameID);
					$( this ).dialog( "close" );
				},
				Cancel: function() {
					$( this ).dialog( "close" );
				}
		}});
		
		$('#dialog-confirm').dialog('open');
	}
	
	function ClearCollectedRequests(gameID)
	{
		$('#dialog-confirm').dialog({
			buttons:
			{
				"Delete all items": function()
				{
					var game = bkP.gamesData[gameID].systemName;
					$('#'+game+'RequestsHistoryList').html('<br style="clear:both" />');
					updateCount(gameID);
					bkP.database.clearTable('requests', gameID, 1);
					$( this ).dialog( "close" );
				},
				Cancel: function() {
					$( this ).dialog( "close" );
				}
		}});
		
		$('#dialog-confirm').dialog('open');
	}
	
	function ClearSentFreeGifts(gameID)
	{
		$('#dialog-confirm').dialog({
			buttons:
			{
				"Delete all items": function()
				{
					var game = bkP.gamesData[gameID].systemName;
					$('#'+game+'SendFreeGiftsHistoryList').html('<br style="clear:both" />');
					bkP.database.clearTable('freegifts', gameID);
					$( this ).dialog( "close" );
				},
				Cancel: function() {
					$( this ).dialog( "close" );
				}
		}});
		
		$('#dialog-confirm').dialog('open');
	}
	
	function addNewRequest(data2)
	{
		var htmls = {};
		var htmlsManual = {};
		
		$(data2).each(function(ind,data)
		{
			var v = {	id: data[0],	title: data[2],	text: data[3],	image: data[4], post: data[5],	time: data[6]	}
			
			var gameID = data[1];
			
			if(typeof(htmls[gameID]) == 'undefined')
			{
				htmls[gameID] = '';
				htmlsManual[gameID] = '';
			}			
			
			if(checkIfRequestIsManual(gameID, v.text))
			{
				htmlsManual[gameID] += getNewManualRequestRow(gameID, v);
			}
			else
			{		
				htmls[gameID] += getNewRequestRow(gameID, v);
			}
		});

		
		for(var tmp in htmls)
		{
			var game = bkP.gamesData[tmp].systemName;
			$('div#'+game+'ManualBonusesList').prepend(htmlsManual[tmp]);
			$('div#'+game+'ManualBonusesList').children('div.manualRequest.awaitingClick').removeClass('awaitingClick').click(processManualRequestClick);
			
			$('div#'+game+'RequestsPendingList').prepend(htmls[tmp]);
			$('div#'+game+'RequestsPendingList').children('div.awaitingClick').removeClass('awaitingClick').click(processRequestsClick);
		}
		
		updateCount();
	}
	
	function createMenu(gameID)
	{
		var game = bkP.gamesData[gameID].systemName;
		
		$(bkP.gamesData[gameID].buttons).each(function(k,id)
		{
			var butName = bkP.submenuButtons[id].name;
			
			$('.optionsMenu', '#'+game+'Game').append('<input type="radio" id="'+game+id+'" gameID="'+gameID+'" sysID="'+id+'" name="'+game+'Menu" class="'+id+'" /><label for="'+game+id+'">'+butName+'</label>');
			
			$('.contentListing', '#'+game+'Game').append('<div id="'+game+id+'List" class="hide"><br style="clear: both" /></div>');
			
			$('.submenu', '#'+game+'Game').append('<div id="'+game+id+'SubMenu" class="hide"><div class="submenuInfo"></div></div>');
			
			if(id == 'BonusesPending')
			{
				$('#'+game+id+'SubMenu').append('<div class="showAllButtonDiv"><input type="checkbox" id="'+game+'ShowAllBonuses'+'" gameID="'+gameID+'" sysID="ShowAllBonuses" class="ShowAllBonuses" /><label for="'+game+'ShowAllBonuses'+'">Show all</label><br /><br /></div>');
			}
			
			if(id == 'NeighborsSearch')
			{
				$('#'+game+id+'List', '#'+game+'Game').html('<h2 class="center">Click above button to start looking for new neighbors</h2>');
			}
			
			if(id == 'SendFreeGifts')
			{
				$('#'+game+id+'List', '#'+game+'Game').html('<h2 class="center">Click above button to load your neighbors list</h2>');
			}
			
			for(var id2 in bkP.submenuButtons[id].submenu)
			{
				var sub = bkP.submenuButtons[id].submenu[id2];
				if(id == 'SendFreeGifts')
				{
					var disabled = (id2 == 'LoadNeighborsList' ? '' : ' class="hide" ');
				}
				else
					var disabled = '';
				
				$('#'+game+id+'SubMenu').append('<button'+disabled+' id="'+game+id2+'" gameID="'+gameID+'" sysID="'+id2+'">'+sub.name+'</button>');
			}
		});
	}
	
	function indicator_switch(mode)
	{
		if(mode == 'on')
		{
			$('.act_indicator').css('visibility', 'visible');
		}
		else
		{
			$('.act_indicator').css('visibility', 'hidden');
		}
	}

	function calcage(secs, num1, num2)
	{
		s = ((Math.floor(secs/num1))%num2).toString();
		if (s.length < 2)
			s = "0" + s;
		return s;
	}

	function lastSeen(seen)
	{
		var today = new Date();
		var diff = today.getTime()-seen.getTime();

		var secs = Math.floor(diff.valueOf()/1000);

		if(secs < 300)
		{
			return true;
		}
		DisplayFormat = "%%H%% Hours, %%M%% Minutes ago";
		DisplayStr = DisplayFormat.replace(/%%H%%/g, calcage(secs,3600,24));
		DisplayStr = DisplayStr.replace(/%%M%%/g, calcage(secs,60,60));

		return DisplayStr.replace(/00 Hours, /, '');
	}

	function populateChat(v, chatID)
	{
		var date = new Date(v.time*1000);
		var s = (date.getSeconds().toString().length == 1 ? "0"+date.getSeconds() : date.getSeconds());
		var m = (date.getMinutes().toString().length == 1 ? "0"+date.getMinutes() : date.getMinutes());
		var h = (date.getHours().toString().length == 1 ? "0"+date.getHours() : date.getHours());
		
		var mod = $('.shouts', chatID).children('div:last').hasClass('bg1') ? '2' : '1';
		
		var addit = '';
		if(v.user_id == 0)
		{
			v.user_id = '100001178615702';
			mod = '4';
			addit = ' style="font-weight: bolder;" ';
		}
		
		var newRow = $('<div id="p'+v.id+'" class="bg'+mod+'"><div class="inner"><div class="chat"><b class="time">'+h+':'+m+':'+s+'</b> by <span class="username"><a title="Click to go to facebook profile" target="_blank" '+addit+' href="http://www.facebook.com/profile.php?id='+v.user_id+'">'+v.user+'</a></span><br> Â» <span class="message">'+v.text+'</span></div></div></div>');
		$('.shouts', chatID).append(newRow);
	}

	function populateOnline(v, chatID)
	{
		var mod = $('.users', chatID).children('div:last').hasClass('bg1') ? '2' : '1';
		
		var img = 'online';
		var addit = '';
		
		if(v.id == 0)
		{
			return;
			v.id = '100001178615702';

			var lastAt = lastSeen(new Date(v.time*1000));

			if(lastAt === true)
			{
				addit = '<br /><span style="font-weight: normal; font-size: 0.8em;">(online now)</span>';
				mod = '3';
			}
			else
			{
				mod = '4';
				img = 'offline';
				addit = '<br /><span style="font-weight: normal; font-size: 0.8em;">(Last seen: '+lastAt+')</span>';
			}
		}
		
		var newRow = $('<div class="bg'+mod+'" style="margin:4px 0"><div class="inner"><div class="username font'+mod+'"><img src="gfx/'+img+'.png" class="online_img"> <a title="Click to go to facebook profile" target="_blank" href="http://www.facebook.com/profile.php?id='+v.id+'">'+v.user+'</a>'+addit+'</div></div></div>');
		$('.users', chatID).append(newRow);
	}

	function send(form)
	{	
		var msg = $(form).find('.message').val();
		var privateVar = $(form).attr('id') == 'privateChat' ? true : false;
		if(msg !== '')
		{
			sendChat(msg, privateVar);
		}
		
	}

	function parseChatData(data, empty)
	{
		if($('.message','#publicChat').attr('disabled') !== false)
		{
			$('.message','#publicChat').val('').removeAttr('disabled');
		}
		
		if(empty === true)
		{
			$('.message','#publicChat').val('').removeAttr('disabled');
		}
		
		$(data.dataPublic).each(function(k,v)
		{
			populateChat(v, '#chatUsers');
		});	
		$('.shoutbox', '#chatUsers').scrollTop(10000);
		
		$('.users', '#chatUsers').html('');
		$(data.onlinePublic).each(function(k,v)
		{
			populateOnline(v, '#chatUsers');
		});
	}

	function switchEnabled(gameID, reload)
	{
		var game = bkP.gamesData[gameID].systemName;
		var enabled  = bkP.options.games[gameID].enabled;
		var e =  bkP.options.games[gameID];

		var el = $('.badgeGames', 'label[for="'+gameID+'Selected"]');
		
		if(enabled == false)
		{
			if(gameID == bkP.options.defaultGame)
			{
				bkP.options.defaultGame = 0;
				bkP.saveOptions();
			}
			$('.gameEnabledBox[gameID="'+gameID+'"]').parent().siblings('label').children('input').attr('disabled', 'disabled');			
			$(el).addClass('hide');
			$('img', 'label[for="'+gameID+'Selected"]').attr('src', 'icons/menu/'+game+'-bw.png');
			$('div.content', 		$('#'+game+'Game')).addClass('hide');
			$('div.notEnabledInfo', $('#'+game+'Game')).removeClass('hide');
			
			if(typeof(reload) != 'undefined')
			{
				/*
				bkP.database.clearByGameID(gameID);
				bkP.options.games[gameID] = bkP.defaultGameOptions;
				*/
				delete bkP.bonusLoadingProgress[gameID];
				$('div.bonusItem, div.requestItem, div.freegiftHistory, div.manualItem', $('#'+game+'Game')).remove();
				updateCount();
				bkP.stopBonusesForGame(gameID);
			}
		}
		else
		{
			$('.gameEnabledBox[gameID="'+gameID+'"]').parent().siblings('label').children('input').removeAttr('disabled');
			$('.gameDefaultBox[gameID="'+gameID+'"], .gameLikeBonusBox[gameID="'+gameID+'"], .gameCommentBonusBox[gameID="'+gameID+'"], .gameSendbackGiftBox[gameID="'+gameID+'"], .gameHideFromFeedBox[gameID="'+gameID+'"], .gameAutoAcceptBonusBox[gameID="'+gameID+'"]').removeAttr('checked');
			
			$('.gameEnabledBox[gameID="'+gameID+'"]').attr('checked', 'checked');
			
			if(gameID == bkP.options.defaultGame)
			{
				$('.gameDefaultBox[gameID="'+gameID+'"]').attr('checked', 'checked');
			}

			if(e.likeBonus)
			{
				$('.gameLikeBonusBox[gameID="'+gameID+'"]').attr('checked', 'checked');
			}
			
			if(e.sendbackGift)
			{
				$('.gameSendbackGiftBox[gameID="'+gameID+'"]').attr('checked', 'checked');			
			}
			
			if(e.hideFromFeed)
			{
				$('.gameHideFromFeedBox[gameID="'+gameID+'"]').attr('checked', 'checked');			
			}
			
			if(e.autoAcceptBonus)
			{
				$('.gameAutoAcceptBonusBox[gameID="'+gameID+'"]').attr('checked', 'checked');
			}

			$(el).removeClass('hide');
			$('img', 'label[for="'+gameID+'Selected"]').attr('src', 'icons/menu/'+game+'.png');
			$('div.content', 		$('#'+game+'Game')).removeClass('hide');
			$('div.notEnabledInfo', $('#'+game+'Game')).addClass('hide');
			
			
			if(typeof(reload) != 'undefined')
			{
				selectFirstTab(gameID);
				loadBonuses(gameID);
				bkP.startBonusesForGame(gameID);
				showSearchGames([gameID]);				
			}			
		}
	}
	
	
	function selectFirstTab(gameID)
	{
		var game = bkP.gamesData[gameID].systemName;
		var enabled  = bkP.options.games[gameID].enabled;
		if(enabled)
		{
			$('.optionsMenu', $('#'+game+'Game')).children('input:nth-child(1)').attr('checked', 'checked').trigger('click');
			$('.optionsMenu', $('#'+game+'Game')).buttonset('refresh');
		}
	}
	
	function updateCount(gameID)
	{
		var processList = {};

		if(typeof(gameID) == 'undefined')
		{
			for(var idd in bkP.options.games)
			{
				if(bkP.options.games[idd].enabled)
				{
					processList[idd] = true;
				}
			}
		}
		else
		{
			processList[gameID] = true;
		}
		
		for(var idd2 in processList)
		{		
			var game = bkP.gamesData[idd2].systemName;
			
			var totCount = 0;
			
			var bCount = $('#'+game+'BonusesPendingList > div').not('.hideScreenLocked').length;
			var rCount = $('#'+game+'RequestsPendingList > div').not('.hideScreenLocked').length;
			var mCount = $('#'+game+'ManualBonusesList > div').not('.hideScreenLocked').length;
			
			totCount += bCount;
			totCount += rCount;
			totCount += mCount;

			$('label[for="'+game+'BonusesPending"]').find('span > span').text(bCount);
			$('label[for="'+game+'RequestsPending"]').find('span > span').text(rCount);
			$('label[for="'+game+'ManualBonuses"]').find('span > span').text(mCount);
			$('label[for="'+idd2+'Selected"]').find('.badgeGames').text(totCount);
		}
	}
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	function getBonusHistoryRow(v)
	{
		if(!v.error_text)
		{
			var errorText = '';
		}
		else
		{
			var errorText = v.error_text;
		}

		var error_text = (errorText != '' ? ' <img src="gfx/info.png" title="'+errorText+'" />' : '');		
		
		var err = (v.error == error_text ? addLikeRow(v.like_bonus, v.resend_gift, v.comment_bonus) : '('+v.error+' error)'+error_text);
		
		if(v.image == 'undefined' && err == '')
		{
			var showImage = 'gfx/90px-check.png';
		}
		else
		{
			var showImage = v.image;
		}
		
		var addClass = '';
		
		
		if(v.error == 'receiving')
		{
			addClass = ' receivingErrorClass ';
		}
		else if(v.error == '')
		{
			addClass = ' noErrorClass ';
		}
		
		return '<div id="'+v.id+'" gameID="'+v.gameID+'" time="'+v.time+'" url="'+v.url+'" class="bonusItem disabled updateTimeAgo '+addClass+'"><span class="timeAgo">'+format_time_ago(v.time)+'</span><span class="bonusError">'+err+'</span><img src="'+showImage+'"><span class="title">'+v.title+'</span><span>'+v.text+'</span></div>';
	}
	
	function getRequestHistoryRow(v)
	{
		if(!v.error_text)
		{
			var errorText = '';
		}
		else
		{
			var errorText = v.error_text;
		}
		
		var error_text = (errorText != '' ? ' <img src="gfx/info.png" title="'+errorText+'" />' : '');
		
		
		var err = (v.error == error_text ? addLikeRow(false, v.resend_gift, false, true) : '('+v.error+' error)'+error_text);
		
		var addClass = '';
		if(v.error == 'receiving')
		{
			addClass = ' receivingErrorClass ';
		}
		else if(v.error == '')
		{
			addClass = ' noErrorClass ';
		}
		
		return '<div id="'+v.id+'" gameID="'+v.gameID+'" time="'+v.time+'" postData="'+v.post+'" class="requestItem disabled updateTimeAgo'+addClass+'"><span class="timeAgo">'+format_time_ago(v.time)+'</span><span class="bonusError">'+err+'</span><img src="'+v.image+'" onError="$(this).attr(\'src\', \'icons/reqs/noimage.png\');"><span class="title">'+v.title+'</span><span>'+v.text+'</span></div>';
	}
	
	function friendsLoaded(gameID, status)
	{
		var game = bkP.gamesData[gameID].systemName;
		var opt = 'NeighborsSearchList';
		
		if(!status)
			var html = '<h3 class="center">There was a problem. Please try again later.</h3>';
		else
		{
			if(status.length == 0)
				var html = '<h3 class="center">Currently there are no people for this game, that are looking for neighbours.</h3>';
			else
			{
				var html = '<h3 class="center">These people are looking for new neighbors:</h3>';
				$(status).each(function(k,v)
				{
					html+='<div class="friendsList"><a href="http://www.facebook.com/profile.php?id='+v+'" class="friendLink" target="_blank">'+v+'</a></div>';
				});
				html+= '<br style="clear: both" />';
			}
		}
		$('div#'+game+opt, '#'+game+'Game').find('.searchForPeopleList').html(html);
	}
	
	function CheckIfNeighborsAvailable(gameID)
	{
		var game = bkP.gamesData[gameID].systemName;
		var opt = 'NeighborsSearchList';
		
		if(!$(".gameListOnNeighborsSearch", '#'+game+'Game').is(':checked'))
		{
			alert('You must check "List me on the neighbors search" before you can search.');
			return;
		}
		
		$('div#'+game+opt, '#'+game+'Game').html('<h2 class="center">Found people:</h2> <div class="searchForPeopleList"><h3 class="center"><img src="gfx/loading.gif"><br />Looking for people who are not already your neighbours... Please wait...</h3></div>');
		
		bkP.searchForNeighbors.Step1(gameID);
	}
	
	function neighborsLoaded(users, gameID)
	{
		var game = bkP.gamesData[gameID].systemName;
		var opt = 'SendFreeGiftsList';
		
		$('.sendingGiftProgress','div#'+game+opt).remove();
		
		if(!users)
		{
			var html = '<h3 class="center">There was a problem. Please try again later.</h3>';
			$('.sendToNeighboursList','div#'+game+opt).html(html);
		}
		else
		{	
			var elF = $('<table sortByIndex="1" class="favouritesTable tablesorter" style="margin: 0 auto; margin-top: 15px;" width="95%"><caption>Your favourites in '+bkP.gamesData[gameID].name+'</caption><thead><tr><th scope="col" class="first">Fav.</th><th scope="col">Name</th><th scope="col">Last bonus</th><th scope="col">Last gift</th><th scope="col">Total bonuses</th><th scope="col">Total gifts</th><th scope="col" class="last">Select</th></tr></thead><tbody></tbody></table>');
			
			var elN = $('<table sortByIndex="1" class="neighborsTable tablesorter" style="margin: 0 auto; margin-top: 15px;" width="95%"><caption>Your neighbors in '+bkP.gamesData[gameID].name+'</caption><thead><tr><th scope="col" class="first">Fav.</th><th scope="col">Name</th><th scope="col">Last bonus</th><th scope="col">Last gift</th><th scope="col">Total bonuses</th><th scope="col">Total gifts</th><th scope="col" class="last">Select</th></tr></thead><tbody></tbody></table>');
			
			var htmlNormal = '';
			var htmlFavourites = '';
			
			var fCnt = nCnt = 1;
			
			$(users).each(function(k,val)
			{
				for(var i in val)
				{
					var id = i;
				}
				var v = val[id];
				
				if($.inArray(id, bkP.options.games[gameID].favourites) != -1)
					var isFav = true;
				else
					var isFav = false;
				
				var newStr = '<tr neighName="'+v.name+'" gameID="'+gameID+'" neighID="'+id+'"><td style="text-align: center">'+(isFav ? '<img src="icons/favourite.png" class="toggleFavourite">' : '<img src="icons/favourite-bw.png" class="toggleFavourite">')+'</td><td>'+v.name+'</td><td class="lastBonus"><span class="hide">0</span>never</td><td class="lastGift"><span class="hide">0</span>never</td><td class="totalBonuses"><span class="hide">0</span>0</td><td class="totalGifts"><span class="hide">0</span>0</td><td class="last"><a href="#" lass="emptyDB"><input type="checkbox" value="'+id+'" class="selectNeighborToSend" name="neighArr[]"></a></td></tr>';
				
				if(isFav)
				{
					htmlFavourites += newStr;
				}
				else
				{
					htmlNormal += newStr;
				}				
			});
			$(elF).find('tbody').html(htmlFavourites);
			; 
			$(elN).find('tbody').html(htmlNormal);
			
			$('.sendToFavouritesList','div#'+game+opt).html(elF);
			$('.sendToNeighboursList','div#'+game+opt).html(elN);
			
			loadNeighborsStats(gameID);
			
			
			$('.sendToNeighboursList','div#'+game+opt).parent().find('.hide').not('td > span').removeClass('hide');
			$('#'+game+'SendFreeGiftsSubMenu > button').removeClass('hide');
			
			
			/*
			$('.addToSendFav',$('.sendToNeighboursList','div#'+game+opt)).bind('click',processAddFavourite);
			
			
			
			$(bkP.options.games[gameID].favourites).each(function(k,v)
			{
				$('input[neighID="'+v+'"]', 'div#'+game+opt).siblings('img').trigger('click');
			});
			*/
		}
		
		
	}
	
	function LoadNeighborsList(gameID)
	{
		var game = bkP.gamesData[gameID].systemName;
		var opt = 'SendFreeGiftsList';
		
		$('div#'+game+opt, '#'+game+'Game').html('<h2 class="center hide">Favourite neighbours:</h2> <div class="sendToFavouritesList hide"></div> <h2 class="center hide">Gifts list:</h2> <div class="hide sendToGiftsList"></div> <h2 class="center">Neighbours list:</h2> <div class="sendToNeighboursList"><h3 class="center"><img src="gfx/loading.gif"><br />Loading your neighbours... Please wait...</h3></div>');
		
		listGifts(gameID);
		
		setTimeout(function(){ bkP.ListNeighbours(gameID) }, 100);
	}

	function windowFocus()
	{
		bkP.newElements = 0;
		bkP.updateIcon();
		bkP.giftlistFocus = true;
	}
	
	function windowBlur()
	{
		bkP.giftlistFocus = false;
	}
	
	$(function()
	{
		$( "#dialog-loading" ).dialog({
			resizable: false,
			width: 400,
			height: 350,
			modal: true,
			position: [Math.floor(($(this).width()-400)/2),200],
			autoOpen: true
		});
		
		$( "#progressbar" ).progressbar({
			value: 0
		});
		
		
		// poczatki ograniczenia eventow
		
		$(window).click(function(e)
		{
			var el = $(e.srcElement)
			if(el.hasClass('toggleFavourite'))
			{
				return processToggleFavourite(el);
			}
			else if(el.hasClass('selectNeighborToSend'))
			{
				return processSelectNeighborToSend(el);
			}
		});
		
		
		
		
		
		
		//database.open(userID);
		
		setTimeout(readNotices, 1);
		setInterval(readNotices, 300000);
		
		
		$('#currentVersion').html('v. '+bkP.currentVersion);

		windowFocus();		
		$(window).focus(windowFocus).blur(windowBlur);

		$(window).unload( function () 
		{
			bkP.giftlistFocus = false;
		});
		
		$('#checkBonusesTimeout > option[value="'+bkP.options.checkBonusesTimeout+'"]').attr('selected', 'selected');
		$('#checkBonusesTimeout').change(function()
		{
			bkP.options.checkBonusesTimeout = $('option:selected', this).val();
			bkP.restartBonuses();
			bkP.saveOptions();
		});
		
		$('#checkChatTimeout > option[value="'+bkP.options.checkChatTimeout+'"]').attr('selected', 'selected');
		$('#checkChatTimeout').change(function()
		{
			bkP.options.checkChatTimeout = $('option:selected', this).val();
			bkP.saveOptions();
		});
		
		$('#deleteOlderThan > option[value="'+bkP.options.deleteOlderThan+'"]').attr('selected', 'selected');
		$('#deleteOlderThan').change(function()
		{
			bkP.options.deleteOlderThan = $('option:selected', this).val();
			bkP.saveOptions();
		});
		
		$('#deleteHistoryOlderThan > option[value="'+bkP.options.deleteHistoryOlderThan+'"]').attr('selected', 'selected');
		$('#deleteHistoryOlderThan').change(function()
		{
			bkP.options.deleteHistoryOlderThan = $('option:selected', this).val();
			bkP.saveOptions();
		});
		
		$('#displayXbonuses > option[value="'+bkP.options.displayXbonuses+'"]').attr('selected', 'selected');
		$('#displayXbonuses').change(function()
		{
			bkP.options.displayXbonuses = $('option:selected', this).val();
			bkP.saveOptions();
			for(var id in bkP.options.games)
			{
				selectFirstTab(id);
			}
		});
		
		$('#collectXbonusesAtTheSameTime > option[value="'+bkP.options.collectXbonusesAtTheSameTime+'"]').attr('selected', 'selected');
		$('#collectXbonusesAtTheSameTime').change(function()
		{
			bkP.options.collectXbonusesAtTheSameTime = $('option:selected', this).val();
			bkP.saveOptions();
		});

		for(var id in bkP.options.games)
		{
			var d =  bkP.gamesData[id];
			var e =  bkP.options.games[id];
			
			$('#templateGame').clone().attr('id', d.systemName+'Game').insertBefore('#chat').find('h1.title').html(d.name+'<br style="clear: both" /><div class="checkOptions"></div><br style="clear: both" />');

			$('<input type="radio" class="gameSelected'+(e.hiddenIcon ? ' hideAtStart' : '')+'" name="gameSelected" sysID="'+d.systemName+'" gameID="'+id+'" id="'+id+'Selected" /><label for="'+id+'Selected">'+d.name+'<br /><img src="icons/menu/'+d.systemName+'.png"><span class="badgeGames"></span></label>').appendTo('#gameSelector');

			$('<label><span>Game enabled</span><input type="checkbox" class="gameEnabledBox" sysID="'+d.systemName+'" gameID="'+id+'" /></label>').appendTo('#'+d.systemName+'Game > h1 > .checkOptions');
			
			$('<label><span>Default game</span><input type="checkbox" class="gameDefaultBox" sysID="'+d.systemName+'" gameID="'+id+'" /></label>').appendTo('#'+d.systemName+'Game > h1 > .checkOptions');
			
			$('<label><span>Post "I like" on bonuses</span><input type="checkbox" class="gameLikeBonusBox" sysID="'+d.systemName+'" gameID="'+id+'" /></label>').appendTo('#'+d.systemName+'Game > h1 > .checkOptions');
			
			$('<label><span>Auto send thank you gift, if possible</span><input type="checkbox" class="gameSendbackGiftBox" sysID="'+d.systemName+'" gameID="'+id+'" /></label>').appendTo('#'+d.systemName+'Game > h1 > .checkOptions');	
			
			$('<label><span>Hide successfully collected bonus from feed</span><input type="checkbox" class="gameHideFromFeedBox" sysID="'+d.systemName+'" gameID="'+id+'" /></label>').appendTo('#'+d.systemName+'Game > h1 > .checkOptions');
			
			$('<label style="display: none"><span>List me on the neighbors search</span><input type="checkbox" class="gameListOnNeighborsSearch" sysID="'+d.systemName+'" gameID="'+id+'" /></label>').appendTo('#'+d.systemName+'Game > h1 > .checkOptions');
			
			$('<label><span>Automatically accept bonuses</span><input type="checkbox" class="gameAutoAcceptBonusBox" sysID="'+d.systemName+'" gameID="'+id+'" /></label>').appendTo('#'+d.systemName+'Game > h1 > .checkOptions');

			//$('<label><span>Post comment on bonuses</span><input type="checkbox" class="gameCommentBonusBox" sysID="'+d.systemName+'" gameID="'+id+'" /></label>').appendTo('#'+d.systemName+'Game > h1 > .checkOptions');
			
			switchEnabled(id);
			createMenu(id);
		}
		
		var enabledGames = [];
		$('.gameEnabledBox[gameID]:checked').each(function()
		{
			enabledGames.push($(this).attr('gameID'));
		});
		
		if(enabledGames.length > 0)
		{
			showSearchGames(enabledGames);
		}
		
		$('input', '.optionsMenu').click(function()
		{
			$(this).closest('.menu').siblings('.submenu').children('div:visible').addClass('hide');
			$('div#'+$(this).attr('id')+'SubMenu').removeClass('hide');
			
			$(this).closest('.menu').siblings('.contentListing').children('div:visible').addClass('hide');
			
			var elList = $('div#'+$(this).attr('id')+'List');
			var elSub  = $('div#'+$(this).attr('id')+'SubMenu');
			
			
			if($(this).attr('sysid') == 'BonusesPending')
			{
				var total = $(elList).children('div').not('.hideScreenLocked').length;
				
				if(bkP.options.displayXbonuses == 0 || $('input.ShowAllBonuses', $(this).closest('.menu').siblings('.submenu')).button().is(':checked'))
				{
					if(bkP.options.displayXbonuses == 0)
						$('div#'+$(this).attr('id')+'SubMenu').children('.submenuInfo').html('').siblings('.showAllButtonDiv').addClass('hide');
					else
						$(elSub).children('.submenuInfo').html('<h3>Displaying ALL ('+total+') bonuses<br /><br /></h3>');
					
					$(elList).removeClass('hide').children('div').not('.hideScreenLocked').removeClass('hide');
					return;
				}
				
				if(total > bkP.options.displayXbonuses)
				{
					$(elSub).children('.submenuInfo').html('<h3>Displaying latest '+bkP.options.displayXbonuses+' bonuses (total: '+total+').<br /><span style="font-size: 0.8em;">(hidden bonuses will be collected / deleted when using "Receive all" / "Clear all")</span><br /><br /></h3>').siblings('.showAllButtonDiv').removeClass('hide');
				}
				else
				{
					$(elSub).children('.submenuInfo').html('<h3>Displaying ALL ('+total+') bonuses<br /><br /></h3>').siblings('.showAllButtonDiv').addClass('hide');
				}
				$(elList).children('div:gt('+(bkP.options.displayXbonuses-1)+')').not('.hideScreenLocked').addClass('hide');
				$(elList).children('div:lt('+(bkP.options.displayXbonuses)+')').not('.hideScreenLocked').removeClass('hide');	
				$(elList).removeClass('hide');
			}
			else
			{
				$(elList).removeClass('hide');
			}
		});
		$('.menu > .optionsMenu').buttonset();
		
		$('<input type="radio" class="gameSelected isOptionsTab" name="gameSelected" id="chatSelected" /><label for="chatSelected">Chat<br /><img src="icons/menu/chat.png"></label>').appendTo('#gameSelector');
		
		$('<input type="radio" class="gameSelected isOptionsTab" name="gameSelected" id="optionsSelected" /><label for="optionsSelected">Options<br /><img src="icons/menu/options.png"></label>').appendTo('#gameSelector');
		
		//$('<input type="radio" class="gameSelected isOptionsTab" name="gameSelected" id="debugSelected" /><label for="debugSelected">Debug logs<br /><img src="icons/menu/debug.png"></label>').appendTo('#gameSelector');

		$("#gameSelector").children("input").click(function()
		{
			$('.gameContent:visible').addClass('hide');
			
			if($(this).attr('id') == 'chatSelected')
			{
				$('#chat').removeClass('hide');
				$('.shouts', '#chat').html('');
				
				setTimeout(function() { readChat(true); }, 1);
				var chatInterval = setInterval(readChat, bkP.options.checkChatTimeout*1000);
				return;
			}
			else if($(this).attr('id') == 'optionsSelected')
			{
				$('#options').removeClass('hide');
				loadOptionsData();
			}
			else if($(this).attr('id') == 'debugSelected')
			{
				$('#debug').removeClass('hide');
				loadDebugData();
			}
			else
			{
				$('#'+$(this).attr('sysID')+'Game').removeClass('hide');
				clearInterval(chatInterval);
				chatInterval = null;
				return;
			}
		});
		
		$(".gameDefaultBox").click(function(a)
		{
			if($(this).is(':checked'))
			{
				bkP.options.defaultGame = $(this).attr('gameID');
				$(".gameDefaultBox").not(this).removeAttr('checked');
			}
			else
			{
				bkP.options.defaultGame = 0;
			}
			bkP.saveOptions();
		});
		
		$(".gameEnabledBox").click(function()
		{
			var game = bkP.gamesData[$(this).attr('gameID')].systemName;


			bkP.options.games[$(this).attr('gameID')].enabled = $(this).is(':checked');
			switchEnabled($(this).attr('gameID'), true);
			bkP.saveOptions();
			bkP.restartRequests();
		});
		
		$(".gameLikeBonusBox").click(function()
		{
			bkP.options.games[$(this).attr('gameID')].likeBonus = $(this).is(':checked') ? true : false;
			bkP.saveOptions();
		});
		
		$(".gameSendbackGiftBox").click(function()
		{
			bkP.options.games[$(this).attr('gameID')].sendbackGift = $(this).is(':checked') ? true : false;
			bkP.saveOptions();
		});
		
		$(".gameHideFromFeedBox").click(function()
		{
			bkP.options.games[$(this).attr('gameID')].hideFromFeed = $(this).is(':checked') ? true : false;
			bkP.saveOptions();
		});
		
		$(".gameListOnNeighborsSearch").click(function()
		{
		
			var action = $(this).is(':checked') ? 'add' : 'remove';
			
			$.getJSON('http://rzadki.eu/projects/fgs/jsonp/friends.php?callback=?', {action: action, games: $(this).attr('gameID'), userID: bkP.userID}, 
			function(r)	{});			
		});
		
		$(".gameAutoAcceptBonusBox").click(function()
		{
			bkP.options.games[$(this).attr('gameID')].autoAcceptBonus = $(this).is(':checked') ? true : false;
			bkP.saveOptions();
		});

		//$(".gameCommentBonusBox").click(function()
		//{
			//bkP.options.games[$(this).attr('gameID')].commentBonus = $(this).is(':checked') ? true : false;
			//bkP.saveOptions();
		//});
		
		
		$(".showContext").live('mouseenter', function()
		{
			if($(this).hasClass('hasContextMenu'))
			{
				return;
			}
			$(this).addClass('hasContextMenu').contextMenu({
				menu: 'myMenu'
			}, function(action, el, pos) {
				
				if(action == 'receive')
				{
					$(el).trigger('click');
				}
				else if(action == 'receiveSimilar')
				{
					$(el).parent().children('div[title="'+$(el).attr('title')+'"]').not('.hideScreenLocked').not('.inProgress').each(function(){
						$(this).trigger('click');
					});
				}
				else if(action == 'delete')
				{
					$(el).remove();
					bkP.database.deleteItem('bonuses', $(el).attr('gameID'), $(el).attr('id'), 0);
					updateCount($(el).attr('gameID'));
				}
				else if(action == 'deleteSimilar')
				{
					$('#dialog-confirm').dialog({
						buttons:
						{
							"Delete all items": function()
							{
								$(el).parent().children('div[title="'+$(el).attr('title')+'"]').not('.hideScreenLocked').not('.inProgress').each(function()
								{
									$(this).remove();
								});
								bkP.database.deleteItemByTitle('bonuses', $(el).attr('gameID'), $(el).attr('title'), 0);
								updateCount($(el).attr('gameID'));
								
								$( this ).dialog( "close" );
							},
							Cancel: function() {
								$( this ).dialog( "close" );
							}
					}});
					
					$('#dialog-confirm').dialog('open');
				}
				else if(action == 'stopCollect')
				{
					$('#dialog-confirm').dialog({
						buttons:
						{
							"Stop collecting": function()
							{
								bkP.options.games[$(el).attr('gameID')].filter.push($(el).attr('title'));
								bkP.saveOptions();
								$(el).parent().children('div[title="'+$(el).attr('title')+'"]').not('.hideScreenLocked').not('.inProgress').each(function()
								{
									$(this).remove();
								});
								bkP.database.deleteItemByTitle('bonuses', $(el).attr('gameID'), $(el).attr('title'), 0);
								updateCount($(el).attr('gameID'));
								
								$( this ).dialog( "close" );
							},
							Cancel: function() {
								$( this ).dialog( "close" );
							}
					}});
					
					$('#dialog-confirm').dialog('open');
				}
				else if(action == 'debug')
				{
					bkP.openURI($(el).attr('url'), true);
				}
			});
		});
		
		$(".showContextManual").live('mouseenter', function()
		{
			if($(this).hasClass('hasContextMenu'))
			{
				return;
			}
			$(this).addClass('hasContextMenu').contextMenu({
				menu: 'myMenuManualBonuses'
			}, function(action, el, pos)
			{
				if(action == 'stopCollect')
				{
					$('#dialog-confirm').dialog({
						buttons:
						{
							"Stop collecting": function()
							{
								bkP.options.games[$(el).attr('gameID')].filter.push($(el).attr('title'));
								bkP.saveOptions();
								$(el).parent().children('div[title="'+$(el).attr('title')+'"]').not('.hideScreenLocked').not('.inProgress').each(function()
								{
									$(this).remove();
								});
								bkP.database.deleteItemByTitle('bonuses', $(el).attr('gameID'), $(el).attr('title'), 0);
								updateCount($(el).attr('gameID'));
								
								$( this ).dialog( "close" );
							},
							Cancel: function() {
								$( this ).dialog( "close" );
							}
					}});
					$('#dialog-confirm').dialog('open');
				}
			});
		});
		
		$("#gameSelector > label").live('mouseenter', function()
		{
			if($(this).hasClass('hasContextMenu2') || $(this).prev().hasClass('isOptionsTab'))
			{
				return;
			}
			$(this).addClass('hasContextMenu2').contextMenu({
				menu: 'myMenuGameIcon'
			}, function(action, el, pos)
			{
				if(action == 'hideIcon')
				{
					var gameID = $(el).prev().attr('gameID');
					$(el).addClass('hide');
					bkP.options.games[gameID].hiddenIcon = true;					
					bkP.saveOptions();
					
					if(!$('#options').hasClass('hide'))
						loadOptionsData();					
				}
				else if(action == 'goToGame')
				{
					var gameID = $(el).prev().attr('gameID');
					bkP.openURI(bkP.gamesData[gameID].link, false);
				}
			});
		});
		
		$(".selectGiftToSend").live('mouseenter', function()
		{
			if($(this).hasClass('hasContextMenu'))
			{
				return;
			}
			$(this).addClass('hasContextMenu').contextMenu({
				menu: 'myMenuDefaultGift'
			}, function(action, el, pos)
			{
				if(action == 'selectDefault')
				{
					$(el).siblings(".selectGiftToSend").removeClass('selected');
					$(el).addClass('selected');
					
					bkP.options.games[$(el).attr('gameID')].defaultGift = $(el).attr('giftID');					
					bkP.saveOptions();
				}
			}).click(function(){
				$(this).siblings("div.selectGiftToSend").removeClass('selected');
				$(this).addClass('selected');
			});
		});
		
		$(".showContextRequests").live('mouseenter', function()
		{
			if($(this).hasClass('hasContextMenu'))
			{
				return;
			}
			$(this).addClass('hasContextMenu').contextMenu({
				menu: 'myMenuRequests'
			}, function(action, el, pos) {
				
				if(action == 'receive')
				{
					$(el).trigger('click');
				}
				else if(action == 'receiveSimilar')
				{
					$(el).parent().children('div[title="'+$(el).attr('title')+'"]').not('.hideScreenLocked').not('.inProgress').each(function()
					{
						$(this).trigger('click');
					});
				}
				else if(action == 'delete')
				{
					var postData = $(el).attr('postData');
					var pos1 = postData.indexOf('&actions%5B');
					
					var postData = postData.slice(0,pos1);
					postData += '&actions[reject]=Ignore';
					$(el).remove();
					bkP.database.deleteItem('requests', $(el).attr('gameID'), $(el).attr('id'), 0);
					updateCount($(el).attr('gameID'));
					
					bkP.emptyUnwantedGifts(postData);
				}
				else if(action == 'deleteSimilar')
				{
					$('#dialog-confirm').dialog({
						buttons:
						{
							"Delete all items": function()
							{

								$(el).parent().children('div[title="'+$(el).attr('title')+'"]').not('.hideScreenLocked').not('.inProgress').each(function()
								{
									var postData = $(this).attr('postData');
									var pos1 = postData.indexOf('&actions%5B');
									
									var postData = postData.slice(0,pos1);
									postData += '&actions[reject]=Ignore';
									$(this).remove();
									bkP.emptyUnwantedGifts(postData);
								});
								
								bkP.database.deleteItemByTitle('requests', $(el).attr('gameID'), $(el).attr('origTitle'), 0);
								updateCount($(el).attr('gameID'));
								
								$( this ).dialog( "close" );
							},
							Cancel: function() {
								$( this ).dialog( "close" );
							}
					}});
					
					$('#dialog-confirm').dialog('open');
				}
				else if(action == 'debug')
				{
					bkP.getRequestLink($(el).attr('id'), $(el).attr('postData')+'&post_form_id='+bkP.post_form_id+'&fb_dtsg='+bkP.fb_dtsg);
				}
			});
		});
		
		$('input#'+bkP.options.defaultGame+'Selected').click();
		$('input#'+bkP.options.defaultGame+'Default').click();
		
		$( "#dialog-confirm" ).dialog({
			resizable: false,
			autoOpen: false,
			height:140,
			modal: true
		});
		
		$( "#dialog-error" ).dialog({
			resizable: false,
			autoOpen: false,
			height:'auto',
			modal: true
		});
		
		$( "#dialog-html" ).dialog({
			resizable: false,
			autoOpen: false,
			height:'auto',
			width: '1000px',
			modal: false,
			buttons:
			{
				"OK": function()
				{
					$( this ).dialog( "close" );
				}
			}
		});

		//$(".gameEnabledBox, .gameDefaultBox, .gameLikeBonusBox, .gameCommentBonusBox").button();
		
		$('.GameOptionsTab').click(function(){ processOptionsTab($(this).attr('gameID')) });

		$('button', '.submenu').button().click(function()
		{
			eval($(this).attr('sysID')+'("'+$(this).attr('gameID')+'")');
		});
		
		$('input.ShowAllBonuses').button().click(function()
		{
			var gameID = $(this).attr('gameID');
			var game = bkP.gamesData[gameID].systemName;
			
			$('.optionsMenu', $('#'+game+'Game')).children('input:nth-child(1)').attr('checked', 'checked').trigger('click');
			$('.optionsMenu', $('#'+game+'Game')).buttonset('refresh');
		});
		
		$("#gameSelector").buttonset();
		
		$('#gameSelector > label').each(function()
		{
			if($(this).prev().hasClass('hideAtStart'))
			{
				$(this).prev().removeClass('hideAtStart');
				$(this).addClass('hide');
			}
		});
		
		$('#lockScreen').button().click(function()
		{
			isScreenLocked = $(this).is(':checked');
			
			if($(this).is(':checked'))
			{
				$(this).button('option', 'label', 'Screen is: LOCKED (no new bonuses will show until you unlock it)');
			}
			else
			{
				$(this).button('option', 'label', 'Screen is: UNLOCKED (click to lock)');
				$('div.hideScreenLocked').removeClass('hideScreenLocked');
				updateCount();
			}
		});
		
		$('#receiveBonusesAllGames').button().click(function()
		{
			for(var idd in bkP.options.games)
			{
				if(bkP.options.games[idd].enabled)
				{
					ReceivePendingBonuses(idd);
				}
			}
		});
		
		$('#receiveGiftsAllGames').button().click(function()
		{
			for(var idd in bkP.options.games)
			{
				if(bkP.options.games[idd].enabled)
				{
					ReceivePendingRequests(idd);
				}
			}
		});
		
		$('#stopReceivingQueue').button().click(function()
		{
			$(bkP.stopQueue()).each(function(k,v)
			{
				var id = v.id;
				
				if(v.type == 'bonus')
				{
					$('#'+id).enableContextMenu().click(processBonusClick).removeClass('inProgress');
					$('#'+id).find('img:last').attr('src', $('#'+id).find('img:last').attr('orig-src'));
				}
				else
				{
					$('#'+id).enableContextMenu().click(processRequestsClick).removeClass('inProgress');
					$('#'+id).find('img:last').attr('src', $('#'+id).find('img:last').attr('orig-src'));
				}
			});
			
			updateQueueCount();
		});
		
		$('#exportSettings').click(function()
		{
			var set = bkP.options;
			var cleanSet = {}
			
			for(var id in set)
			{
				if(typeof(bkP.defaultOptions[id]) != 'undefined')
				{
					cleanSet[id] = set[id];
				}
			}	
			var set = JSON.stringify(cleanSet);

			$('#settingsTextarea').click(function(){
				$(this).focus().select();
			});
			
			$('#settingsTextarea').val(set).trigger('click');			
		});
		
		$('#importSettings').click(function()
		{
			var txt = $('#settingsTextarea').val();
			
			try
			{
				if(txt == '') throw {}
				var set = JSON.parse(txt);

				var cleanSet = {}
				
				for(var id in set)
				{
					if(typeof(bkP.defaultOptions[id]) != 'undefined')
					{
						cleanSet[id] = set[id];
					}
				}
				
				alert('New data loaded. Use FGS icon to open this page again');
				bkP.options = bkP.jQuery.extend(true,{}, bkP.defaultOptions,	cleanSet);
				bkP.FBloginError = null;
				bkP.updateIcon();
				bkP.sendView('closeAndOpen');
			}
			catch(e)
			{
				alert('There was a problem importing data, make sure you have copied whole text from your file.');
			}			
		});
		
		

		setTimeout(loadBonuses, 1);
		//Screen is: UNLOCKED (click to lock)
	});
	
	function updateQueueCount()
	{
		$('#queueItemsCount').text(bkP.xhrQueue.length);
	}
	
	function processSaveNewComment()
	{
		if($(this).prev('textarea').val() != '')
		{
			var msg = $(this).prev('textarea').val();
			bkP.options.defaultCommentsMessages.push(msg);
			bkP.saveOptions();
			loadOptionsData();
		}
	}
	
	function processDeleteComment()
	{
		bkP.options.defaultCommentsMessages.splice($(this).attr('delIndex'),1);
		bkP.saveOptions();
		
		$(this).parent().remove();
		loadOptionsData();
	}
	
	function processSelectNeighborToSend(e)
	{
		var gameID = $(e).closest('tr').attr('gameID');
		var game = bkP.gamesData[gameID].systemName;
		var opt = 'SendFreeGiftsList';

		var count = parseInt($('input[name="neighArr[]"]:checked', 'div#'+game+opt).length);

		if(e.altKey === undefined)
		{
			count++;
		}

		if(count > 25)
		{
			return false;
		}
	}
	
	function processToggleFavourite(e)
	{
		var srcEl	= $(e).closest('tr');
		var gameID 	= srcEl.attr('gameID');
		var uID		= srcEl.attr('neighID');
		var uName	= srcEl.attr('neighName');
				
		var game = bkP.gamesData[gameID].systemName;
		var opt = 'SendFreeGiftsList';
				
		var idx = bkP.options.games[gameID].favourites.indexOf(uID);
				
		if(idx == -1)
		{
			bkP.options.games[gameID].favourites.push(uID);
			srcEl.find('.toggleFavourite').attr('src', 'icons/favourite.png');
			$('.favouritesTable', 'div#'+game+opt).find('tbody').append(srcEl);
		}
		else
		{
			bkP.options.games[gameID].favourites.splice(idx, 1);
			srcEl.find('.toggleFavourite').attr('src', 'icons/favourite-bw.png');
			$('.neighborsTable', 'div#'+game+opt).find('tbody').append(srcEl);
		}
		$('.neighborsTable, .favouritesTable', 'div#'+game+opt).trigger("update");
		bkP.saveOptions();
	}
	
	function processLikeBonus()
	{
		if(!$(this).hasClass('disabledLike'))
		{
			var bonusID = $(this).parent().parent().parent().parent().attr('id');
			$(this).attr('src', 'gfx/act_indicator.gif');
			bkP.likeBonus(bonusID);
		}
	}

	function processCommentBonus()
	{
		if(bkP.options.defaultCommentsMessages.length == 0)
		{
			alert('You must setup comment messages first in options tab');
		}
		else
		{
			if(!$(this).hasClass('disabledComment'))
			{
				var randNum = Math.floor(Math.random()*(bkP.options.defaultCommentsMessages.length));
				var bonusID = $(this).parent().parent().parent().parent().attr('id');
				$(this).attr('src', 'gfx/act_indicator.gif');
				bkP.commentBonus(bonusID, bkP.options.defaultCommentsMessages[randNum]);
			}
		}
	}
	
	function processSendBack()
	{
		if(!$(this).hasClass('disabledSendback'))
		{
			var bonusID = $(this).parent().parent().parent().parent().attr('id');
			$(this).attr('src', 'gfx/act_indicator.gif');

			var gameID =  $(this).parent().parent().parent().parent().attr('gameID');
			
			var tempData = JSON.parse($(this).next().text());
			
			var params = {
				gift: tempData.gift,
				gameID:	gameID,
				sendTo: [tempData.destInt],
				sendToName: tempData.destName,
				thankYou: true,
				bonusID: bonusID,	
				isRequest: $(this).parent().parent().parent().parent().hasClass('bonusItem') ? false : true
			};
			
			var game = bkP.gamesData[gameID].systemName;
			
			eval('bkP.'+game+'Freegifts.Click(params)');
		}
	}
	
	function unhideGameIcon()
	{
		bkP.options.games[$(this).attr('gameID')].hiddenIcon = false;
		bkP.saveOptions();
		
		$('#gameSelector > input[gameID="'+$(this).attr('gameID')+'"]').next().removeClass('hide');
		loadOptionsData();
	}

	function loadOptionsData()
	{
		$('#defaultCommentsMessages').html('');
		
		$(bkP.options.defaultCommentsMessages).each(function(i,msg)
		{
			$('#defaultCommentsMessages').append('<div style="float: left; width: 250px;margin-right: 10px;"><img src="icons/delete-16.png" delIndex="'+i+'" style="cursor: pointer;width: 10px;height: 10px" class="deleteComment" title="Delete comment"> '+msg+'</div>');
		});
		$('.deleteComment', '#defaultCommentsMessages').click(processDeleteComment);
		

		$('#defaultCommentsMessages').append('<br style="clear:both" /><textarea style="margin-top: 50px;" class="newCommentText"></textarea><button id="saveNewComment">Add new comment</button>');
		$('#saveNewComment').click(processSaveNewComment);
		
		$('#hiddenIconList').html('');
		
		var i = 0;
		
		for(var gameID in bkP.options.games)
		{
			if(bkP.options.games[gameID].hiddenIcon)
			{
				i++;
				var gameName = bkP.gamesData[gameID].name;
				$('#hiddenIconList').append('<div style="float: left; width: 250px;margin-right: 10px;"><img src="icons/delete-16.png" gameID="'+gameID+'" style="cursor: pointer;width: 10px;height: 10px" class="unhideGameIcon'+gameID+'" title="Unhide game icon"> '+gameName+'</div>');
				
				$('.unhideGameIcon'+gameID).click(unhideGameIcon);
			}
		}
		if(i == 0)
		{
			$('#hiddenIconList').html('<h4>You have currently no game icons hidden.</h4>To hide game icon: Right click unwanted icon in the Game Selector and select "Hide icon"</h4>');
		}
		$('#hiddenIconList').append('<br style="clear:both" /><br />');
	}
	
	function loadDebugData()
	{
		$('#debug').html('');
		
		$('#debug').prepend('<table id="debugLogs" style="margin: 0 auto; margin-top: 15px;" width="75%"><caption>Logs from your current session (send only when requested!!!)</caption><thead><tr><th scope="col" class="first">Time</th><th scope="col">Type</th><th scope="col">Text</th><th scope="col" class="last">HTML</th></tr></thead><tbody></tbody></table>');
				
		var tempArr = bkP.debugLog;
		tempArr = tempArr.reverse();
				
		$(tempArr).each(function(k,info)
		{
			var linkA = info.html == '' ? '' : 'View html';
			
	
			$('#debugLogs > tbody').append('<tr><td class="first">'+info.time+'</td><td>'+info.type+'</td><td>'+info.text+'</td><td class="last"><div logID="'+k+'" class="viewHtml">'+linkA+'</div></td></tr>');
		});
		
		$('#debug').append('<br style="clear:both" />');
	}
	
	
	function updateSendback(bonusID, success)
	{
		if(success)
		{
			$('img.sendBack', '#'+bonusID).removeClass('sendBack').attr('src', 'gfx/sendback-off.png').css('cursor', 'default').attr('title', 'You already sent gift back');
		}
		else
		{
			$('img.sendBack', '#'+bonusID).attr('src', 'gfx/sendback.png');
		}
	}
	
	function updateLike(bonusID, error)
	{
		
		var img = $('img.likeBonus', '#'+bonusID);
		
		if(img.length > 0)
		{
			updateLikeState('#'+bonusID, error);
		}
		else
		{
			if(error == 0)
			{
				$('#'+bonusID).attr('isLiked', 1);
			}
		}
	}
	
	function updateLikeState(selector, error)
	{
		if(error == 0)
		{
			$('img.likeBonus', selector).addClass('disabledLike').removeClass('likeBonus').attr('src', 'gfx/like-off.png').css('cursor', 'default').attr('title', 'You already liked this');
		}
		else
		{
			$('img.likeBonus', selector).attr('src', 'gfx/like.png');
		}
	}
	
	function updateCommentState(selector, error)
	{
		if(error == 0)
		{
			$('img.commentBonus', selector).addClass('disabledComment').removeClass('commentBonus').attr('src', 'gfx/comment-off.png').css('cursor', 'default').attr('title', 'You already commented this');
		}
		else
		{
			$('img.commentBonus', selector).attr('src', 'gfx/comment.png');
		}
	}
	
	function updateComment(bonusID, error)
	{
		var img = $('img.commentBonus', '#'+bonusID);
		
		if(img.length > 0)
		{
			updateCommentState('#'+bonusID, error);
		}
		else
		{
			if(error == 0)
			{
				$('#'+bonusID).attr('isCommented', 1);
			}
		}
	}
	
	function changeSendbackState(bonusID)
	{
		var img = $('img.sendBack', '#'+bonusID);
		
		if(img.length > 0)
		{
			updateSendbackState('#'+bonusID);
		}
		else
		{
			$('#'+bonusID).attr('SendbackInProgress', 1);
		}
	}
	
	function updateSendbackState(selector)
	{
		$('img.sendBack', selector).addClass('disabledSendback').css('cursor', 'default').attr('src', 'gfx/act_indicator.gif').attr('title', 'Sending back is in progress');
	}
	
	setInterval('updateTimeAgo()', 15000);
	
	function processOptionsTab(gameID)
	{
	
		var arr = bkP.options.games[gameID].filter;
		
		arr.sort();
		
		var opt = 'GameOptionsTabList';
		
		var html = '<div class="gameOptionsFiltersList"><br style="clear: both" /></div>';
		var game = bkP.gamesData[gameID].systemName;
		
		
		$('.deleteFilter').unbind('click');
		
		$('div#'+game+opt, '#'+game+'Game').html('');
		
		
		$('div#'+game+opt, '#'+game+'Game').prepend(html);

		if(arr.length == 0)
		{
			$('div#'+game+opt, '#'+game+'Game').find('.gameOptionsFiltersList').prepend('<h4>You have currently no filters.</h4>To add some: Right click unwanted bonus and select "Don\'t collect this type of bonuses"</h4>');
		}
		
		for(var i = 0; i < arr.length; i++)
		{
			var v = arr[i];
			var html = '<div style="float: left; width: 250px;margin-right: 10px;"><img src="icons/delete-16.png" delIndex="'+i+'" gameID="'+gameID+'" style="cursor: pointer;width: 10px;height: 10px" class="deleteFilter" title="Delete filter"> '+v+'</div>';

			$('div#'+game+opt, '#'+game+'Game').find('.gameOptionsFiltersList').prepend(html);
		}
		
		$('.deleteFilter').click(function()
		{
			var gameID = $(this).attr('gameID');
			
			bkP.options.games[gameID].filter.splice($(this).attr('delIndex'),1);
			bkP.saveOptions();
			
			$(this).parent().remove();
			processOptionsTab(gameID);
		});
	}
	
	function compareTime(itemTime, olderThan)
	{
		var now = new Date().getTime();
		var itemTime = new Date(itemTime*1000).getTime();
		
		var diff = now-itemTime;
		var secs = Math.floor(diff.valueOf()/1000);		
		return(secs > olderThan ? true : false);
	}
	
	function showSearchGames(enabledGames)
	{
		$.getJSON('http://rzadki.eu/projects/fgs/jsonp/friends.php?callback=?', {action: 'status', games: enabledGames.join(), userID: bkP.userID}, 
		function(r)
		{
			for(var gid in r)
			{
				var el = $('.gameListOnNeighborsSearch[gameID="'+gid+'"]');
				if(r[gid])
					el.attr('checked', 'checked');
				el.closest('label').show();
			}
		});
	}
	
	function updateTimeAgo()
	{
		var olderThanTime = bkP.options.deleteHistoryOlderThan;
		var olderBonusThanTime = bkP.options.deleteOlderThan;

		$('.updateTimeAgo:visible').each(function()
		{
			var time = $(this).attr('time');
			var timeAgo = format_time_ago(time)
			$(this).find('.timeAgo').html(timeAgo);
		
			if($(this).hasClass('inProgress'))
			{
				return;
			}
			
			
			if($(this).hasClass('bonusItem') || $(this).hasClass('manualBonus'))
			{
				if($(this).hasClass('disabled'))
				{
					if(olderThanTime == 0)
					{
						return;
					}
					
					if(compareTime($(this).attr('time'), olderThanTime))
					{
						$(this).remove();
					}
				}
				else
				{
					if(olderBonusThanTime == 0)
					{
						return;
					}
					
					if(compareTime($(this).attr('time'), olderBonusThanTime))
					{
						var gameIDtmp = $(this).attr('gameID');
						$(this).remove();
						updateCount(gameIDtmp);
					}
				}
			}
			else if($(this).hasClass('requestItem'))
			{
				if($(this).hasClass('disabled'))
				{
					if(olderThanTime == 0)
					{
						return;
					}
					
					if(compareTime($(this).attr('time'), olderThanTime))
					{
						$(this).remove();
					}
				}
			}
			else if($(this).hasClass('freegiftHistory'))
			{
				if(olderThanTime == 0)
				{
					return;
				}
				
				if(compareTime($(this).attr('time'), olderThanTime))
				{
					$(this).remove();
				}
			}
		});
	}
</script>
</head>
<body>
	<div id="dialog-confirm" title="Delete?">
		<p><span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span><span class="text">Are you sure?</span></p>
	</div>
	
	<div id="dialog-html" title="View HTML">
	
	</div>
	
	<div id="dialog-error" title="Error">
		<p><span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span><span class="text"></span></p>
	</div>
	
	<div id="dialog-loading" title="Loading Gifts and Bonuses List">
		<h3 class="center"><img src="gfx/dl.gif"><br />FGS is loading... Please wait.</h3><br /><br />
		<span>(It may take a few minutes if you've got many bonuses in the database. If it takes very long - consider using Panic Button option)</span><br />
		<div id="progressbar"></div>
	</div>

	<div style="float: left; width: 25%;">
		<div class="leftBox section">
			<span style="font-weight: bold; margin-bottom: 10px;display: block;">Please donate, if you feel this extension deserves it:</span>
				<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank">
					<input type="hidden" name="cmd" value="_s-xclick">
					<input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----MIIHPwYJKoZIhvcNAQcEoIIHMDCCBywCAQExggEwMIIBLAIBADCBlDCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20CAQAwDQYJKoZIhvcNAQEBBQAEgYAEFizunAwBxFiL4sFLBIotb535+ocEmKKtiS1IoOSJp/DaSTZPqVuO3htltMPtf0hoK9NCUR7b7gO5pAbe65gAppwFtiJt3pqXLddBOanG7s05Qa7XmvF7Grc7THou6uQg6FE9RU2LGpvH9uojTl4I+8sFL0EIlZxppuQ9Yn/7rTELMAkGBSsOAwIaBQAwgbwGCSqGSIb3DQEHATAUBggqhkiG9w0DBwQImWNtK/DACmaAgZhilxW6eiEiPWoeKbLX4oP6TK5o8+kKJwQ0V3tn/l1nF2D+cUBnIBN+gHnFyIFfQYqGxZeLaF2VrKICUi+fiHrVE+2/9wOoJ3llbC/dCF5j1lb5dTI78woYa4k9tkq1Xq5RvhjLx+s6FKekeGnLIFDV6KZmAGCGLzf7PSzQFMbeDr9PUEMJClIEF2LP3s0LpMNf0WIL3np8vKCCA4cwggODMIIC7KADAgECAgEAMA0GCSqGSIb3DQEBBQUAMIGOMQswCQYDVQQGEwJVUzELMAkGA1UECBMCQ0ExFjAUBgNVBAcTDU1vdW50YWluIFZpZXcxFDASBgNVBAoTC1BheVBhbCBJbmMuMRMwEQYDVQQLFApsaXZlX2NlcnRzMREwDwYDVQQDFAhsaXZlX2FwaTEcMBoGCSqGSIb3DQEJARYNcmVAcGF5cGFsLmNvbTAeFw0wNDAyMTMxMDEzMTVaFw0zNTAyMTMxMDEzMTVaMIGOMQswCQYDVQQGEwJVUzELMAkGA1UECBMCQ0ExFjAUBgNVBAcTDU1vdW50YWluIFZpZXcxFDASBgNVBAoTC1BheVBhbCBJbmMuMRMwEQYDVQQLFApsaXZlX2NlcnRzMREwDwYDVQQDFAhsaXZlX2FwaTEcMBoGCSqGSIb3DQEJARYNcmVAcGF5cGFsLmNvbTCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAwUdO3fxEzEtcnI7ZKZL412XvZPugoni7i7D7prCe0AtaHTc97CYgm7NsAtJyxNLixmhLV8pyIEaiHXWAh8fPKW+R017+EmXrr9EaquPmsVvTywAAE1PMNOKqo2kl4Gxiz9zZqIajOm1fZGWcGS0f5JQ2kBqNbvbg2/Za+GJ/qwUCAwEAAaOB7jCB6zAdBgNVHQ4EFgQUlp98u8ZvF71ZP1LXChvsENZklGswgbsGA1UdIwSBszCBsIAUlp98u8ZvF71ZP1LXChvsENZklGuhgZSkgZEwgY4xCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEWMBQGA1UEBxMNTW91bnRhaW4gVmlldzEUMBIGA1UEChMLUGF5UGFsIEluYy4xEzARBgNVBAsUCmxpdmVfY2VydHMxETAPBgNVBAMUCGxpdmVfYXBpMRwwGgYJKoZIhvcNAQkBFg1yZUBwYXlwYWwuY29tggEAMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADgYEAgV86VpqAWuXvX6Oro4qJ1tYVIT5DgWpE692Ag422H7yRIr/9j/iKG4Thia/Oflx4TdL+IFJBAyPK9v6zZNZtBgPBynXb048hsP16l2vi0k5Q2JKiPDsEfBhGI+HnxLXEaUWAcVfCsQFvd2A1sxRr67ip5y2wwBelUecP3AjJ+YcxggGaMIIBlgIBATCBlDCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20CAQAwCQYFKw4DAhoFAKBdMBgGCSqGSIb3DQEJAzELBgkqhkiG9w0BBwEwHAYJKoZIhvcNAQkFMQ8XDTEwMDgwOTE3MTM1M1owIwYJKoZIhvcNAQkEMRYEFLMxIEFzo2VmIaZkEKz7rbQx4yf1MA0GCSqGSIb3DQEBAQUABIGAbrqa2E3YMzTBCCGIOLcxLi9DE2SybLdkFTb3dLE7Y2WNpzkJq/9tCFHKNU1D98oVKE28Ivh7MAfxZbp+PU/eRQoEonzdEvOWpOhQt00Gj1ClXpm9eFhH3InHSfAk+AMZb493hhYUXTdiKHKoPYrlmFk4++ar3Ts85AIXFDx3+Ts=-----END PKCS7-----">
					<input style="width: 90px;background-color: transparent;border:0px;" type="image" src="gfx/btn_donate_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">

				</form>
				<span style="font-weight: bold; margin-bottom: 10px;display: block;">If you need to contact me, use these links:</span>
				<a href="http://facebook.com/fliesPL" target="_blank" title="Go to my Facebook profile"><img src="gfx/facebook.png" width="16" height="16" alt="Facebook"></a>
				<a href="http://fgs.rzadki.eu/#contact" target="_blank" title="Send me an e-mail"><img src="gfx/mail.png" width="16" height="16" alt="E-mail"></a>
				<a href="http://flies.blip.pl" target="_blank" title="Go to my Blip profile"><img src="gfx/blip.png" width="16" height="16" alt="Blip.pl"></a>
				<a href="http://blog.fgs.rzadki.eu" target="_blank" title="Go to FGS Blog"><img src="gfx/blogger.png" width="16" height="16" alt="Blogger"></a>
				<span style="font-weight: bold; margin-bottom: 10px;display: block;">If you encountered a problem, bug or want to file feature request, visit our message board:</span>
				<a href="http://rzadki.eu/projects/fgs/board/" target="_blank" title="Go to FGS Board"><img src="gfx/forum.png" width="16" height="16" alt="Message Board"></a>
				
				<br /><br />
				<div id="fbLike" style="margin: 0 auto; text-align:center">
				<iframe src="http://www.facebook.com/plugins/like.php?href=http%3A%2F%2Fwww.facebook.com%2Fpages%2FFGS%2F150480078326371&amp;layout=button_count&amp;show_faces=true&amp;width=100&amp;action=like&amp;font=verdana&amp;colorscheme=light&amp;height=21" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:100px; height:21px;" allowTransparency="true"></iframe>
				</div>
		</div>
		
		<div class="section leftBox" id="notices">
			<h3>Notices:</h3>
			<br />
			<div id="noticesScript" style="display:none"></div>
			<div id="noticesContent">
			
			</div>
		</div>
		
	</div>
	
	
	<div style="float: right;width: 75%">
		<h1 class="icon" style="background-image: url(gfx/32px-icon.png); float: left;">Friendly Gaming Simplifier <span id="currentVersion"></span></h1>
		
		<div class="section" style="float: left;text-align: center;clear:left;">
			<h3>Game selector:</h3>
			<span id="gameSelector" style="display: block;text-align:center;">
			</span>
		</div>

		<br style="clear: both" />
		
		<h2 style="text-align: center">
			<button style="font-size: 0.8em;" id="receiveBonusesAllGames">Receive bonuses from all games</button>
			<input type="checkbox" id="lockScreen" /><label for="lockScreen">Screen is: UNLOCKED (click to lock)</label>
			<button style="font-size: 0.8em;" id="receiveGiftsAllGames">Receive gifts from all games</button>
			<br />
			<button style="font-size: 0.8em;" id="stopReceivingQueue">Reset queue (<span id="queueItemsCount">0</span>)</button>
		</h2>
		
		<br style="clear: both" />
		
		
		<div id="templateGame" class="section hide gameContent">
			<h1 class="title"></h1>

			<div class="notEnabledInfo" style="text-align: center">
				Please enable this game to start collecting updates.
			</div>
			
			<div class="content hide">
				<div class="menu">
					<span class="optionsMenu"></span>
				</div>
				
				<div class="submenu">
				</div>
				
				<div class="contentListing">
					
				</div>			
			</div>
		</div>

		<div id="chat" class="section hide gameContent">
			
			<h1 class="title">Chat</h1>
				<div align="left" id="chatUsers" class="chatContent right">
					<h2 style="text-align:center;border-bottom:1px dashed #000;padding-bottom:5px;">All users Chat</h2>
					<div class="shoutbox">
						<div class="shouts"></div>
					</div>
					
					<div class="onlinelist">
						<div class="onlineText"><strong>Users online:</strong></div>
						<div class="users"></div>
					</div>
					
					<div style="border-top: 1px dashed #000;padding-top: 10px;">
						<form method="post" action="javascript:void(0);" onsubmit="send(this)" id="publicChat" autocomplete="off">
							<img src="./gfx/act_indicator.gif" class="act_indicator" style="visibility: hidden; ">
							<strong>Message:</strong> <input type="text" tabindex="1" disabled="disabled" name="message" class="message" value="Chat is disabled, because your userdata was not retrieved yet">
								<!-- <input type="submit" class="sendChatBut button1" disabled="disabled" value="Send" name="submit" tabindex="6" accesskey="s">  -->
						</form>
					</div>
				</div>
				<br style="clear: both" />
		</div>
		
		<div id="options" class="section hide gameContent">
			
			<h1 class="title">Options</h1>
			
				<h3 class="settings">Import / export settings</h3>
				
				<textarea cols="40" rows="5" id="settingsTextarea"></textarea><br /><br />
				
				<button id="importSettings">Import</button> <button id="exportSettings">Export</button>	<br /><br /><br />
				
				
				<h4>How to import:</h4>
				- open the file with previously exported settings<br />
				- select whole text inside it<br />
				- paste text into the above box and press import button
				
				<br /><br />
				
				<h4>How to export:</h4>
				- press export button<br />
				- copy selected text to the new file
				
				<br /><br /><br />
				
				<h3 class="settings">Hidden game icons</h3>
				<div id="hiddenIconList"></div>
				
						
				<h3 class="settings">How many bonuses to display by default per game (others will be hidden)</h3>
					<select id="displayXbonuses">
						<option value="0">all of them</option>
						<option value="100">100</option>
						<option value="300">300</option>
						<option value="1000">1000</option>
						<option value="3000">3000</option>
					</select>	
				
				<h4>How many bonuses to COLLECT at the same time (don't set it high unless you know what you're doing, change it only if you have very fast connection)</h4>
					<select id="collectXbonusesAtTheSameTime">
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="5">5</option>
						<option value="10">10</option>
						<option value="15">15</option>
						<option value="25">25</option>
						<option value="30">30</option>
					</select>	
		
				<h4>Bonuses check timeout</h4>
					<select id="checkBonusesTimeout">
						<option value="15">15 seconds</option>
						<option value="30">30 seconds</option>
						<option value="60">1 minute</option>
						<option value="120">2 minutes</option>
						<option value="300">5 minutes</option>
						<option value="600">10 minutes</option>
					</select>
				<!--
				<h4>Gifts check timeout</h4>
					<select id="checkRequestsTimeout">
						<option value="30">30 seconds</option>
						<option value="60">1 minute</option>
						<option value="120">2 minutes</option>
						<option value="300">5 minutes</option>
						<option value="600">10 minutes</option>
					</select>
				-->
				<h4>Chat check timeout</h4>
					<select id="checkChatTimeout">
						<option value="15">15 seconds</option>
						<option value="30">30 seconds</option>
						<option value="60">1 minute</option>
						<option value="120">2 minutes</option>
					</select>
				<h4>Delete bonuses older than</h4>
					<select id="deleteOlderThan">
						<option value="0">Don't</option>
						<option value="1800">30 minutes</option>
						<option value="3600">1 hour</option>
						<option value="7200">2 hours</option>
						<option value="10800">3 hours</option>
						<option value="21600">6 hours</option>
						<option value="43200">12 hours</option>
						<option value="86400">1 day</option>
						<option value="172800">2 days</option>
						<option value="259200">3 days</option>
					</select>
				<h4>Delete history older than</h4>
					<select id="deleteHistoryOlderThan">
						<option value="0">Don't</option>
						<option value="1800">30 minutes</option>
						<option value="3600">1 hour</option>
						<option value="7200">2 hours</option>
						<option value="10800">3 hours</option>
						<option value="21600">6 hours</option>
						<option value="43200">12 hours</option>
						<option value="86400">1 day</option>
						<option value="172800">2 days</option>
						<option value="259200">3 days</option>					
					</select>
				
				<br /><br /><br /><br />
				<h4>Default Comments Messages</h4>
				<div id="defaultCommentsMessages"></div>
			
			<br style="clear: both" />
		</div>
		
		<div id="debug" class="section hide gameContent">
		
		</div>
	</div>	
	
	<ul id="myMenu" class="contextMenu">
		<li class="receive"><a href="#receive">Receive this bonus</a></li>
		<li class="receive"><a href="#receiveSimilar">Receive all "<span class="bonusName"></span> (<span class="bonusNameCount"></span>)"</a></li>
		<li class="delete separator"><a href="#delete">Delete this bonus</a></li>
		<li class="delete"><a href="#deleteSimilar">Delete all "<span class="bonusName"></span> (<span class="bonusNameCount"></span>)"</a></li>
		<li class="delete separator"><a href="#stopCollect">Don't collect this type of bonuses "<span class="bonusName"></span>"</a></li>
		<li class="debug"><a href="#debug">Debug (for developer)</a></li>
	</ul>
	
	<ul id="myMenuManualBonuses" class="contextMenu">
		<li class="delete"><a href="#stopCollect">Don't collect this type of bonuses "<span class="bonusName"></span>"</a></li>
	</ul>
	
	<ul id="myMenuRequests" class="contextMenu">
		<li class="receive"><a href="#receive">Receive this gift</a></li>
		<li class="receive"><a href="#receiveSimilar">Receive all "<span class="bonusName"></span> (<span class="bonusNameCount"></span>)"</a></li>
		<li class="delete separator"><a href="#delete">Delete this gift</a></li>
		<li class="delete"><a href="#deleteSimilar">Delete all "<span class="bonusName"></span> (<span class="bonusNameCount"></span>)"</a></li>
		<li class="debug"><a href="#debug">Debug (for developer)</a></li>
	</ul>
	
	<ul id="myMenuDefaultGift" class="contextMenu">
		<li class="receive"><a href="#selectDefault">Select as default gift</a></li>
	</ul>
	
	<ul id="myMenuGameIcon" class="contextMenu">
		<li class="goToGame"><a href="#goToGame"><strong>Go to this game!</strong></a></li>
		<li class="delete"><a href="#hideIcon">Hide this game icon</a></li>
	</ul>
	
	
</body>
</html>
